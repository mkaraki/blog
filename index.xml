<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mkarakiのブログ</title><link>https://blog.mkarakiapps.com/</link><description>Recent content on mkarakiのブログ</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><lastBuildDate>Mon, 27 Dec 2021 00:00:00 +0900</lastBuildDate><atom:link href="https://blog.mkarakiapps.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Google Pixel Buds A-Seriesを買った話</title><link>https://blog.mkarakiapps.com/p/20211227-pixel-buds-a/</link><pubDate>Mon, 27 Dec 2021 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20211227-pixel-buds-a/</guid><description>&lt;p>初めてレビュー記事みたいなものを書きますが、
&lt;a class="link" href="https://store.google.com/jp/product/pixel_buds_a_series" target="_blank" rel="noopener"
>Pixel Buds A-Series&lt;/a>を手に入れたので軽く使い勝手を書き連ねていきます。&lt;/p>
&lt;h2 id="もともとは乗り換え用">もともとは乗り換え用&lt;/h2>
&lt;p>もともとは&lt;a class="link" href="https://www.sony.jp/xperia-smart-products/products/XEA20/" target="_blank" rel="noopener"
>Xperia Ear Duo&lt;/a>と
&lt;a class="link" href="https://www.bose.co.jp/ja_jp/support/products/bose_headphones_support/bose_in_ear_headphones_support/soundsport-free-wireless.html" target="_blank" rel="noopener"
>SoundSport Free wireless headphones&lt;/a>
の乗り換え用で買ったものです。&lt;/p>
&lt;p>ついでに、&lt;a class="link" href="https://www.sony.jp/headphone/products/MDR-EX750BT/" target="_blank" rel="noopener"
>h.ear in Wireless&lt;/a>の代替として使えたらいいなという考えでした。&lt;/p>
&lt;p>値段差が3分の1くらいのものなので正直期待はしていませんでしたが、
結論から言うと１万円でこれはかなりありな製品だったのではと思います。&lt;/p>
&lt;h2 id="音の感じ方">音の感じ方&lt;/h2>
&lt;p>私の耳は音質の差を聞き取れるほど良い耳ではないので感じ方だけ。&lt;/p>
&lt;p>SoundSport Freeや初代h.ear in Wirelessでは「音楽に包まれている」という感覚でしたが、
こちらは「音楽を聴いている」という感覚です。&lt;/p>
&lt;p>悪いことではないですが音楽に浸りたいのであればBoseやSonyのお高めのイヤホンを買うべきでしょう。&lt;/p>
&lt;p>雰囲気はXperia Ear Duoの音をもっといい感じにしたものです。&lt;/p>
&lt;h2 id="遮音性">遮音性&lt;/h2>
&lt;p>ノイズキャンセリングや外音取り込みはついていません。&lt;/p>
&lt;p>しかし、音として入ってくるのは大まかな音で会話内容はわからないレベルには遮音性はあります。&lt;/p>
&lt;p>個人的には遮音性が高すぎるため、
会話がイヤホンを取り外さずにできるように外音取り込み機能はあったほうがよかったかなと思いました。
別に音質求めないので通話用のマイクで適当に実装してほしかったと思います。&lt;/p>
&lt;h2 id="通知アシスタント機能">通知・アシスタント機能&lt;/h2>
&lt;p>通知機能はとても便利です。&lt;/p>
&lt;p>しかし、Xperia Earシリーズと違い、特定アプリからの通知が来た際にベルが鳴る形です。&lt;/p>
&lt;p>この状態で本体のタッチパネルを長押しすると通知を読み上げてくれます。&lt;/p>
&lt;h2 id="音量の自動調整">音量の自動調整&lt;/h2>
&lt;p>音量調整機能ですが、Xperia Earの場合、相対的に現在の音量から調整してきますが、
Pixel Budsは絶対値で合わせているのではないかと思うほど音量を上げてきます。&lt;/p>
&lt;h2 id="pixelとの連携">Pixelとの連携&lt;/h2>
&lt;p>Pixelシリーズとの連携は最強です。&lt;/p>
&lt;p>端末設定から本体の設定をできるので普通に便利です。&lt;/p>
&lt;h2 id="最後に">最後に&lt;/h2>
&lt;p>Androidユーザでしたら、普通にありな選択だと思いました。&lt;/p>
&lt;p>個人的には片耳利用の際にどっちの耳でも聞けるのはよかったです。&lt;/p></description></item><item><title>謎の l.instagram.com ドメインが含まれているDMについて</title><link>https://blog.mkarakiapps.com/p/20211225-instagram-link/</link><pubDate>Sat, 25 Dec 2021 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20211225-instagram-link/</guid><description>&lt;p>今Twitterを騒がしている&lt;code>l.instagram.com&lt;/code>ドメインのメッセージですが、
先日このメッセージが来たので、これの正体について少し探ろうと思います。&lt;/p>
&lt;p>この記事内では無害化した複数のリンクを記述しているがもし除く場合は自己責任でどうぞ。&lt;/p>
&lt;h2 id="届いたメッセージ">届いたメッセージ&lt;/h2>
&lt;p>&lt;a href="https://user-images.githubusercontent.com/26180919/147385322-6fca6ec3-89bd-46df-ae4a-24e863c63b5b.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/147385322-6fca6ec3-89bd-46df-ae4a-24e863c63b5b.png"
loading="lazy" alt="image" >
&lt;/a>&lt;/p>
&lt;p>リンク(無害化済み):&lt;/p>
&lt;pre tabindex="0">&lt;code>https:// l [dot] instagram [dot] com /?[My Twitter ID]_41_4559965334=e208e6be6eb9bf297853619e7cbeeeb5&amp;amp;e=ATO57b9Db1Mn3Ux88bPC-yAhRTW3Y4c9jBdUr86_sREpA1AL0RtYnjrvhw3WWJked-hV2C2V&amp;amp;s=1&amp;amp;s=1&amp;amp;u=http:// business [dot] instagram [dot] com /micro_site/url/?event_type=click&amp;amp;site=igb&amp;amp;destination=https%3A%2F%2Fwww.facebook.com%2Fads%2Fig_redirect%2F%3Fd%3DAd-9UUpXVqVLNUx_LYaKZeKek5oYlWjoEdXwzKgPbUE9qRpf4p77ahkKJVJ0kuzPpFtsCo6iNW3tiZLDTY2LPR4xCa63d0ycYdTB4uq9n11GSU2h81N4csFuuiw8b0crQB08jWUYW08n1cc2LujG0j00JXW6R7_-_xEeAwWPs56HHv7PQhgj6ktkhSEU5AhwI8vAMSgikxz8VtJ4JiQRzIjL%26a%3D1%26hash%3DAd9_0TyBjc1n8sHe
&lt;/code>&lt;/pre>&lt;p>わかる人にはわかると思いますが、&lt;code>l.instagram.com&lt;/code>ドメインはTwitterなどで使われているような&lt;code>t.co&lt;/code>ドメインのような役割を持っています。&lt;/p>
&lt;p>つまり、これは別サイトへのリンクになっているようです。&lt;/p>
&lt;p>&lt;a class="link" href="https://web-omusubi.com/blog/omusubi79.html" target="_blank" rel="noopener"
>ソース&lt;/a>&lt;/p>
&lt;h2 id="このメッセージのリンク先">このメッセージのリンク先&lt;/h2>
&lt;p>最終的には&lt;code>https:// m [dot] ztney [dot] com /#BST&lt;/code>に飛ばされます。&lt;/p>
&lt;p>流れとしては&lt;/p>
&lt;ol>
&lt;li>t.coからLocationヘッダで&lt;code>http://l.instagram.com&lt;/code>に飛ぶ&lt;/li>
&lt;li>そのまま307, Locationヘッダで&lt;code>https://l.instagram.com&lt;/code>に飛ぶ&lt;/li>
&lt;li>JavaScriptまたはrefreshタグで下記に飛ぶ&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>https:// business [dot] instagram [dot] com /micro_site/url/?event_type=click&amp;amp;site=igb&amp;amp;destination=https://www.facebook.com/ads/ig_redirect/?d=Ad-9UUpXVqVLNUx_LYaKZeKek5oYlWjoEdXwzKgPbUE9qRpf4p77ahkKJVJ0kuzPpFtsCo6iNW3tiZLDTY2LPR4xCa63d0ycYdTB4uq9n11GSU2h81N4csFuuiw8b0crQB08jWUYW08n1cc2LujG0j00JXW6R7_-_xEeAwWPs56HHv7PQhgj6ktkhSEU5AhwI8vAMSgikxz8VtJ4JiQRzIjL&amp;amp;a=1&amp;amp;hash=Ad9_0TyBjc1n8sHe
&lt;/code>&lt;/pre>&lt;ol start="4">
&lt;li>302, Locationタグで下記に飛ぶ&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>https:// www [dot] facebook [dot] com /ads/ig_redirect/?d=Ad-9UUpXVqVLNUx_LYaKZeKek5oYlWjoEdXwzKgPbUE9qRpf4p77ahkKJVJ0kuzPpFtsCo6iNW3tiZLDTY2LPR4xCa63d0ycYdTB4uq9n11GSU2h81N4csFuuiw8b0crQB08jWUYW08n1cc2LujG0j00JXW6R7_-_xEeAwWPs56HHv7PQhgj6ktkhSEU5AhwI8vAMSgikxz8VtJ4JiQRzIjL&amp;amp;a=1&amp;amp;hash=Ad9_0TyBjc1n8sHe
&lt;/code>&lt;/pre>&lt;ol start="5">
&lt;li>302, Locationタグで&lt;code>http:// bartinkizogrenciyurdu [dot] com /STALK&lt;/code>に飛ぶ&lt;/li>
&lt;li>307, Locationタグで&lt;code>https&lt;/code>に飛ぶ&lt;/li>
&lt;li>5,6の流れをURL末端に&lt;code>/&lt;/code>を入れて実施&lt;/li>
&lt;li>302, Locationで&lt;code>https://m [dot] ztney [dot] com/_BST_&lt;/code>に飛ぶ&lt;/li>
&lt;li>いろいろあって&lt;code>https:// m [dot] ztney [dot] com /#BST&lt;/code>に飛ぶ（理由がわからんかった）&lt;/li>
&lt;/ol>
&lt;p>このリンクはよくできていて、&lt;code>t.co&lt;/code>を経由していないと(ほかにも条件はありそうですが)&lt;a class="link" href="https://business.instagram.com/" target="_blank" rel="noopener"
>Instagram business&lt;/a>に飛ばされます。&lt;/p>
&lt;h2 id="log-in-with-twitterの挙動">LOG IN WITH TWITTERの挙動&lt;/h2>
&lt;p>最終的にはTwitterのアプリケーション連携に行くが、途中の流れは下記のようになる。&lt;/p>
&lt;ol>
&lt;li>ボタンは&lt;code>https://m [dot] ztney [dot] com/gir&lt;/code>に飛ぶ&lt;/li>
&lt;li>302, Locationで&lt;code>https://www [dot] twitbu [dot] com/web/bridge.php?ref=ztney&lt;/code>に飛ぶ&lt;/li>
&lt;li>ランダムなトークンを設定した状態で、302でTwitterの連携画面に&lt;/li>
&lt;/ol>
&lt;p>&lt;code>oauth_token&lt;/code>の値が毎回変更されているのが個人的には面白かった。
連携アプリケーション名はランダムで変更されているようだ。&lt;/p>
&lt;p>連携画面はこんな感じ。
&lt;a href="https://user-images.githubusercontent.com/26180919/147386075-4a528ae5-6673-4326-a715-a28b857eccff.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/147386075-4a528ae5-6673-4326-a715-a28b857eccff.png"
loading="lazy" alt="image" >
&lt;/a>&lt;/p>
&lt;p>&lt;del>たれか暇な人API制限かかるまでアカウント登録してみてくれないかな…&lt;/del>&lt;/p>
&lt;h2 id="最後に">最後に&lt;/h2>
&lt;p>こういうの調べるの楽しい！&lt;/p></description></item><item><title>簡単なサービス紹介用のページテンプレートを作った話</title><link>https://blog.mkarakiapps.com/p/20211221-webtemplate/</link><pubDate>Tue, 21 Dec 2021 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20211221-webtemplate/</guid><description>&lt;p>何かしらのサービス向けの簡単なテンプレートを作ったので紹介ページを書きます。&lt;/p>
&lt;p>ライセンスは未定です
（多分MITにしてHTMLとCSSに書くと思う）&lt;/p>
&lt;h2 id="見た目">見た目&lt;/h2>
&lt;p>&lt;a href="https://user-images.githubusercontent.com/26180919/146897964-0677a0df-b1e5-4a67-ad80-25b1da076677.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/146897964-0677a0df-b1e5-4a67-ad80-25b1da076677.png"
loading="lazy" alt="Simple One Page Template" >
&lt;/a>&lt;/p>
&lt;p>こんな感じのテンプレートです。&lt;/p>
&lt;p>全画面使って少しの情報を載せるスタイルのページが複数ページ分含まれます。&lt;/p>
&lt;p>一応、&lt;a class="link" href="https://mkarakiapps.com/simple-one-page-template/" target="_blank" rel="noopener"
>ここ&lt;/a>からフルのデモページを見ることができます。&lt;/p>
&lt;h2 id="使った技術">使った技術&lt;/h2>
&lt;p>&lt;a class="link" href="https://github.com/necolas/normalize.css" target="_blank" rel="noopener"
>normalize.css&lt;/a>と&lt;a class="link" href="https://icons.getbootstrap.com/" target="_blank" rel="noopener"
>Bootstrap Icons&lt;/a>を利用しました。&lt;/p>
&lt;p>Bootstrap Iconsは下向き矢印のためだけに使ったので別のやつに置き換えたいなと思っています。&lt;/p>
&lt;p>また、デモページの画像用に&lt;a class="link" href="https://picsum.photos/" target="_blank" rel="noopener"
>Lorem Picsum&lt;/a>を利用してます。
このサービス、ランダムに指定した解像度の画像を持ってきてくれるのでかなり重宝しています&lt;/p>
&lt;h2 id="最後に">最後に&lt;/h2>
&lt;p>とりあえずお気持ちでサービスの紹介ページやノリで取ったドメインのWebページなどにご利用されてみてはいかがでしょうか。&lt;/p>
&lt;p>作例をコメント欄に貼っていただければ私が見に行くかもしれません。&lt;/p></description></item><item><title>簡易的なメール受信のセキュリティ的な話</title><link>https://blog.mkarakiapps.com/p/20211212-mailsecurity/</link><pubDate>Sun, 12 Dec 2021 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20211212-mailsecurity/</guid><description>&lt;p>普段私はメールサーバからのレポートやCron Daemonからのメールくらいしか受け取りませんが、
近頃人間からメールを受け取る機会が増えたのでセキュリティについて語ろうと思います。&lt;/p>
&lt;h2 id="ppapとは">PPAPとは&lt;/h2>
&lt;p>Japanese Mail Cultureといえば&lt;a class="link" href="https://ja.wikipedia.org/wiki/PPAP_%28%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%29" target="_blank" rel="noopener"
>PPAP&lt;/a>でしょう。&lt;/p>
&lt;blockquote>
&lt;p>Password付きZIPファイルを送ります、Passwordを送ります、Angoka（暗号化）Protocol（プロトコル）&lt;/p>
&lt;p>JIPDEC, &lt;a class="link" href="https://www.jaipa.or.jp/event/isp_mtg/asahikawa_190912-13/190913-3.pdf" target="_blank" rel="noopener"
>くたばれPPAP！ ～メールにファイルを添付する習慣を変えるところから始める働き方改革～&lt;/a> より&lt;/p>
&lt;/blockquote>
&lt;p>日本企業においてはマナーなどと形容される謎文化です。&lt;/p>
&lt;p>この文化の難点はただ一つ、パスワード付きzipファイルはセキュリティを通り抜ける点です。&lt;/p>
&lt;p>試しに、&lt;a class="link" href="https://www.7-zip.org/" target="_blank" rel="noopener"
>7-Zip&lt;/a>などのツールで適当にパスワード付きzipを作って&lt;a class="link" href="https://www.virustotal.com/" target="_blank" rel="noopener"
>Virus Total&lt;/a>あたりに投げてみてください。
普段なら賛否両論なソフトウェアもあっという間に安全なファイルに早変わりします。&lt;/p>
&lt;p>&lt;a href="https://user-images.githubusercontent.com/26180919/145703763-2b50090f-6719-4ca1-8a3a-59f727e9e7bf.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/145703763-2b50090f-6719-4ca1-8a3a-59f727e9e7bf.png"
loading="lazy" alt="やばいファイル" >
&lt;/a>&lt;br>
生の状態のやばいファイル&lt;/p>
&lt;p>&lt;a href="https://user-images.githubusercontent.com/26180919/145703728-98402092-af08-4bb3-8542-c612fa99b791.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/145703728-98402092-af08-4bb3-8542-c612fa99b791.png"
loading="lazy" alt="PPAPされたやばいファイル" >
&lt;/a>&lt;br>
PPAPされたやばいファイル&lt;/p>
&lt;p>ちなみに、今回スキャンに掛けた&lt;a class="link" href="https://shinolocker.com/" target="_blank" rel="noopener"
>ShinoLocker&lt;/a>はランサムウェアと同じ動作をするテスト用シミュレータです。
もし本物のランサムウェアが現場のセキュリティをかいくぐって職場に入り込んだら…ぞっとしますよね。&lt;/p>
&lt;p>実際にEmotetの感染経路にPPAPが存在します。(&lt;a class="link" href="https://www.ipa.go.jp/security/announce/20191202.html" target="_blank" rel="noopener"
>IPAの記事&lt;/a>)&lt;/p>
&lt;h3 id="ppap撲滅派の動き">PPAP撲滅派の動き&lt;/h3>
&lt;p>PPAPは百害あって一利なしの存在です。&lt;/p>
&lt;p>人によっては誤送信防止という人もいるかもしれませんが、
パスワードをすぐに送る時点で誤送信防止かは怪しいですし、
そもそもパスワード付きzipのパスワードは簡易的なものが多く、総当たり可能な桁数であることがほとんどです。&lt;/p>
&lt;p>例えば&lt;a class="link" href="https://www.iij.ad.jp/" target="_blank" rel="noopener"
>IIJ&lt;/a>は&lt;a class="link" href="https://www.iij.ad.jp/ppap/" target="_blank" rel="noopener"
>パスワード付きzipファイルが添付されたメールを受信サーバ側で破棄する運用に変更されました&lt;/a>。&lt;/p>
&lt;p>これを受け、私個人や、団体としてもPPAPを施されたメールをすべてブロックするか、
相手にZipファイルのハッシュ値を電話で確認するなどの手法でセキュリティ対策としています。&lt;/p>
&lt;h2 id="spfdkim">SPF/DKIM&lt;/h2>
&lt;p>SPF/DKIMは発信者特定の技術です。
双方の違いは&lt;a class="link" href="https://sendgrid.kke.co.jp/blog/?p=10121" target="_blank" rel="noopener"
>SendGridが出している記事&lt;/a>がとても参考になります。&lt;/p>
&lt;p>これらを設定していない企業からのメールは本当にそのメールが当該企業から来たものなのかを判定することが難しいため、
一度電話やSMSなどの連絡手段を用いてメールが本人から送られたものなのかを確認する運用をしています。&lt;/p>
&lt;p>注意点として、SPFレコードが設定されてるメールの場合、メールの転送を行うとFAILになります。
DKIMはこのような問題が起きないため、DKIMも必ず設定し、SPFはSOFTFAILにすることをお勧めしています。&lt;/p>
&lt;p>また、DMARCを設定することによって、自社ドメインを騙ったメールが送信されているかを簡単に確認することができるので、設定をお勧めします。&lt;/p>
&lt;h2 id="文面">文面&lt;/h2>
&lt;p>最後は送信者に対する忠告の意が大きいです。&lt;/p>
&lt;p>Gmailなどのメールプロバイダでは文面でメールをブロックする場合があるそうです。&lt;/p>
&lt;p>例えばハートが使われていたり、&lt;code>? 、 。&lt;/code>が多用されていたりなど、
どう考えてもビジネスメールとして相応しくないメールは迷惑メールボックス行きになります。&lt;/p>
&lt;p>また、直接的な金銭の要求なども迷惑メールボックス行きになります。&lt;/p>
&lt;p>確かに、現代では個人同士のやり取りにメールを利用することは少なくなりましたし、
このフィルターは妥当に思えますが、親しい間柄のビジネスメールでは未だありそうなケースです。
送信者の方はご注意ください。&lt;/p></description></item><item><title>MAASの用語と設定のメモ</title><link>https://blog.mkarakiapps.com/p/20211204-maas-word/</link><pubDate>Sat, 04 Dec 2021 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20211204-maas-word/</guid><description>&lt;p>MAASには複数の単位(&lt;code>Fabric&lt;/code>など)があります。
本体にも説明は記述されているのですが、自分があとで見返しやすい様にメモにします。&lt;/p>
&lt;p>ここで書いていることはすべて私の想像です。&lt;/p>
&lt;h2 id="availability-zones">Availability zones&lt;/h2>
&lt;p>場所で区切った単位。&lt;/p>
&lt;p>例:&lt;/p>
&lt;ul>
&lt;li>東京データセンター&lt;/li>
&lt;li>大阪データセンター&lt;/li>
&lt;/ul>
&lt;p>など?&lt;/p>
&lt;h2 id="subnet---space">Subnet -&amp;gt; Space&lt;/h2>
&lt;p>SpaceはphpIPAMでいうL2 Domainを指します。&lt;/p>
&lt;p>Spaceが違う場合、普通はVLANは通せません。&lt;/p>
&lt;p>同一のインテリジェントスイッチにつながっていないLANケーブルの集合体であると思います。&lt;/p>
&lt;h2 id="subnet---fabric">Subnet -&amp;gt; Fabric&lt;/h2>
&lt;p>よくわからない&lt;/p>
&lt;h2 id="resource-pool">Resource Pool&lt;/h2>
&lt;p>リソースを管理する際に利用する単位&lt;/p>
&lt;h2 id="controller">Controller&lt;/h2>
&lt;p>&lt;a href="https://discourse.maas.io/uploads/default/original/1X/02a7ca58b989c67c74421b9d5e0c8b32907a2de1.jpeg" >
&lt;img src="https://discourse.maas.io/uploads/default/original/1X/02a7ca58b989c67c74421b9d5e0c8b32907a2de1.jpeg"
loading="lazy" alt="システム図" >
&lt;/a>&lt;br>
Image from: &lt;a class="link" href="https://maas.io/docs/snap/2.9/ui/controllers" target="_blank" rel="noopener"
>https://maas.io/docs/snap/2.9/ui/controllers&lt;/a>&lt;/p>
&lt;h3 id="rack-controller">Rack Controller&lt;/h3>
&lt;p>DHCPやPXE、IPMI管理などを提供するサーバ&lt;/p>
&lt;h3 id="region-controller">Region Controller&lt;/h3>
&lt;p>DNSやWebUIなどを提供するサーバ&lt;/p></description></item><item><title>日本の公的個人認証サービスを利用したPDF署名とその受け入れ</title><link>https://blog.mkarakiapps.com/p/20211202-jpki-sign/</link><pubDate>Thu, 02 Dec 2021 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20211202-jpki-sign/</guid><description>&lt;h2 id="初めに">初めに&lt;/h2>
&lt;p>&lt;a class="link" href="https://www.jpki.go.jp" target="_blank" rel="noopener"
>公的個人認証サービス(JPKI)&lt;/a>は国および地方公共団体が共同で運営する&lt;a class="link" href="https://www.j-lis.go.jp/" target="_blank" rel="noopener"
>地方公共団体情報システム機構&lt;/a>の提供するサービスである。&lt;/p>
&lt;p>この記事では2021/12/02時点でのこのサービスとマイナンバーカードを利用したPDF署名とその受け入れについて記述するため、今後この記事の内容が利用できなくなる可能性も存在する。&lt;/p>
&lt;p>マイナンバーに関する法律は多くあり、それらを遵守したうえで本ページを参考にしていただきたい。この記事が必ずにも現在の法律に&lt;strong>適応しているわけではない&lt;/strong>ことを留意したうえで閲覧していただきたい。&lt;/p>
&lt;h2 id="署名により記録される情報">署名により記録される情報&lt;/h2>
&lt;p>署名をすることにより、下記の個人情報がPDFファイルに記載される。&lt;/p>
&lt;ul>
&lt;li>氏名&lt;/li>
&lt;li>マイナンバー上に記述されている都道府県及び市町村&lt;/li>
&lt;/ul>
&lt;p>上記情報を渡したくない相手に対しては署名したファイルを送信しないことを強く推奨する。&lt;/p>
&lt;h2 id="サードパーティ製のソフトウェアを利用して署名する">サードパーティ製のソフトウェアを利用して署名する&lt;/h2>
&lt;p>公式的に署名する方法は&lt;a class="link" href="https://www.touki-kyoutaku-online.moj.go.jp/cautions/security/pdf_sign_inst.html" target="_blank" rel="noopener"
>PDF署名プラグイン&lt;/a>を利用する方法が&lt;a class="link" href="https://www.moj.go.jp/" target="_blank" rel="noopener"
>法務省&lt;/a>(&lt;a class="link" href="https://www.touki-kyoutaku-online.moj.go.jp/" target="_blank" rel="noopener"
>登記ねっと 供託ねっと&lt;/a>)から提供されている。
しかし、この方法では&lt;a class="link" href="https://www.adobe.com/" target="_blank" rel="noopener"
>Adobe Inc.&lt;/a>の&lt;a class="link" href="https://www.adobe.com/acrobat.html" target="_blank" rel="noopener"
>Adobe Acrobat&lt;/a>が必要であり、個人では敷居が高い。(無料版の&lt;a class="link" href="https://www.adobe.com/acrobat/pdf-reader.html" target="_blank" rel="noopener"
>Adobe Acrobat Reader&lt;/a>では署名の検証のみ可能)&lt;/p>
&lt;p>今回は有志の方が開発した&lt;a class="link" href="https://jpki.osdn.jp/" target="_blank" rel="noopener"
>JPKI PDF SIGNER&lt;/a>(無料)を利用する。&lt;/p>
&lt;h3 id="事前準備">事前準備&lt;/h3>
&lt;p>あらかじめカードリーダのドライバをインストールしておく必要がある。&lt;/p>
&lt;h3 id="利用者クライアントソフトのインストール">利用者クライアントソフトのインストール&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.jpki.go.jp" target="_blank" rel="noopener"
>JPKI&lt;/a>の提供する&lt;a class="link" href="https://www.jpki.go.jp/download/index.html" target="_blank" rel="noopener"
>利用者クライアントソフト&lt;/a>をダウンロードし、インストールする必要がある。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>注意:&lt;/strong>
WindowsのロケールはJapaneseである必要性がある。この設定がされていない場合インストーラや本体ソフトウェアが動作しない。&lt;/p>
&lt;/blockquote>
&lt;h3 id="jpki-pdf-signerのダウンロード">JPKI PDF SIGNERのダウンロード&lt;/h3>
&lt;p>先に説明した通り、&lt;a class="link" href="https://jpki.osdn.jp/" target="_blank" rel="noopener"
>JPKI PDF SIGNER&lt;/a>は有志の開発したマイナンバー用のPDF署名ソフトウェアである。&lt;/p>
&lt;p>もし第三者の作成したソフトウェアに不信感を感じる場合、&lt;a class="link" href="https://ja.osdn.net/projects/jpki/" target="_blank" rel="noopener"
>OSDNページ&lt;/a>からソースコードをダウンロードし、ユーザ側で検証とビルドを行うことを推奨する。&lt;/p>
&lt;p>このアプリケーションにインストーラは存在しない。&lt;a class="link" href="https://jpki.osdn.jp/" target="_blank" rel="noopener"
>公式ページ&lt;/a>からzipファイルをダウンロードし、各自で解凍して利用する。&lt;/p>
&lt;h3 id="署名を行う">署名を行う&lt;/h3>
&lt;p>&lt;a class="link" href="https://jpki.osdn.jp/" target="_blank" rel="noopener"
>公式サイト&lt;/a>に操作方法が記述されているので説明は不要であると思うが念のために記述する。&lt;/p>
&lt;h4 id="印影を利用しない署名">印影を利用しない署名&lt;/h4>
&lt;p>JPKI PDF SIGNERでPDFファイルを開き、右側メニューの&lt;code>印影なしで電子署名する&lt;/code>をクリックする。
マイナンバーカードがコンピュータに認識されていれば&lt;a class="link" href="https://www.e-tax.nta.go.jp/toiawase/qa/kanbenka/27.htm" target="_blank" rel="noopener"
>公的個人認証　署名用パスワード&lt;/a>の入力が求められる。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>注意:&lt;/strong>
&lt;a class="link" href="https://www.jpki.go.jp" target="_blank" rel="noopener"
>JPKI&lt;/a>のサイトでは、「署名用電子証明書のパスワードを5回間違えるとロックされ、市区町村窓口でのロック解除が必要となる。」とアナウンスされている。&lt;/p>
&lt;p>詳細は&lt;a class="link" href="https://www.jpki.go.jp/procedure/password.html" target="_blank" rel="noopener"
>パスワードの失念&lt;/a>を参照のこと。&lt;/p>
&lt;/blockquote>
&lt;h2 id="署名された文章の受け入れ">署名された文章の受け入れ&lt;/h2>
&lt;p>署名の検証には&lt;a class="link" href="https://www.adobe.com/" target="_blank" rel="noopener"
>Adobe Inc.&lt;/a>の&lt;a class="link" href="https://www.adobe.com/acrobat/pdf-reader.html" target="_blank" rel="noopener"
>Adobe Acrobat Reader&lt;/a>(無料)を利用する。&lt;/p>
&lt;h3 id="adobe-acrobat-readerのインストール">Adobe Acrobat Readerのインストール&lt;/h3>
&lt;p>&lt;a class="link" href="https://helpx.adobe.com/jp/acrobat/kb/cq101423182.html" target="_blank" rel="noopener"
>公式インストールマニュアル&lt;/a>を参考に&lt;a class="link" href="https://www.adobe.com/acrobat/pdf-reader.html" target="_blank" rel="noopener"
>Adobe Acrobat Reader&lt;/a>をインストールする。&lt;/p>
&lt;h3 id="ルート証明書のダウンロード">ルート証明書のダウンロード&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.jpki.go.jp" target="_blank" rel="noopener"
>JPKI&lt;/a>サイトからルート証明書をダウンロードする。&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://www.jpki.go.jp/ca/index.html" target="_blank" rel="noopener"
>認証局の運営&lt;/a>ページにアクセスする。&lt;/li>
&lt;li>画面左メニューから&lt;a class="link" href="https://www.jpki.go.jp/ca/ca_rules3.html" target="_blank" rel="noopener"
>署名用認証局の運営に関する情報&lt;/a>を開く&lt;/li>
&lt;li>&lt;code>署名用認証局の自己署名証明書&lt;/code>を選択しダウンロードする。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>注意:&lt;/strong>
署名用認証局の自己署名証明書は存在するすべての証明書をダウンロードし追加すること。
これは、マイナンバー(証明書)発行時期により利用されているルート証明書が異なるためである。&lt;/p>
&lt;/blockquote>
&lt;h3 id="ルート証明書の追加">ルート証明書の追加&lt;/h3>
&lt;p>悲しいことにAdobe Acrobat ReaderにはJPKIで利用されている署名用認証局の自己署名証明書は信頼リストに追加されていない。
そのため、手動で信頼リストに追加する必要がある。&lt;/p>
&lt;p>下記に手順を示す&lt;/p>
&lt;ol>
&lt;li>Acrobat Readerを開きウィンドウ上部のメニューバーから&lt;code>編集&lt;/code>-&amp;gt;&lt;code>環境設定&lt;/code>と進む&lt;/li>
&lt;li>設定画面左側のメニューから&lt;code>署名&lt;/code>を選択&lt;/li>
&lt;li>&lt;code>IDと信頼済み証明書&lt;/code>メニューを開く&lt;/li>
&lt;li>ウィンドウ左メニューから&lt;code>信頼済み証明書&lt;/code>を選択&lt;/li>
&lt;li>画面上部の&lt;a href="https://user-images.githubusercontent.com/26180919/144451492-feb927af-564f-4a08-a84c-84f49b491647.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/144451492-feb927af-564f-4a08-a84c-84f49b491647.png"
loading="lazy" alt="取り込み" >
&lt;/a>を選択&lt;/li>
&lt;li>新規ウィンドウ上側リスト右の参照を選択&lt;/li>
&lt;li>ダウンロードしたルート証明書を選択&lt;/li>
&lt;li>複数のルート証明書をダウンロードした場合は手順&lt;code>6.&lt;/code>から別の証明書を読み込む&lt;/li>
&lt;li>ウィンドウ下の取り込みボタンを選択&lt;/li>
&lt;li>Acrobat Readerを再起動する&lt;/li>
&lt;li>再度手順&lt;code>4.&lt;/code>まで進める&lt;/li>
&lt;li>&lt;code>公的個人認証サービス署名用, 地方公共団体情報システム機構&lt;/code>から始まる証明書を1つずつ選択し、&lt;a href="https://user-images.githubusercontent.com/26180919/144453978-7a28b974-b635-4af8-9c6d-ed52da298023.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/144453978-7a28b974-b635-4af8-9c6d-ed52da298023.png"
loading="lazy" alt="信頼性を編集" >
&lt;/a>ボタンを選択する&lt;/li>
&lt;li>&lt;code>この証明書を信頼済みのルートとして使用&lt;/code>にチェックを入れ、画面下&lt;code>OK&lt;/code>をクリックする&lt;/li>
&lt;li>2つ以上追加した場合は手順&lt;code>12.&lt;/code>に戻りすべての証明書に実施する&lt;/li>
&lt;li>再度Acrobat Readerを再起動する&lt;/li>
&lt;/ol>
&lt;p>以上でルート証明書が信頼リストに追加される。&lt;/p>
&lt;h3 id="署名を検証する">署名を検証する&lt;/h3>
&lt;p>Acrobat Readerで検証したいファイルを開く。&lt;/p>
&lt;p>&lt;a href="https://user-images.githubusercontent.com/26180919/144454484-dcf3f6dc-fcef-4c5a-8265-ad1bb7e49c04.png" >
&lt;img src="https://user-images.githubusercontent.com/26180919/144454484-dcf3f6dc-fcef-4c5a-8265-ad1bb7e49c04.png"
loading="lazy" alt="署名済みであり、すべての署名が有効です。" >
&lt;/a>&lt;br>
の表示が出れば問題ない。&lt;/p>
&lt;h4 id="署名者を確認する">署名者を確認する&lt;/h4>
&lt;p>&lt;a class="link" href="#%e7%bd%b2%e5%90%8d%e3%82%92%e6%a4%9c%e8%a8%bc%e3%81%99%e3%82%8b" >署名を検証する&lt;/a>セクションで出たアラートにある&lt;code>署名パネル&lt;/code>ボタンを選択する&lt;/p>
&lt;ul>
&lt;li>署名者を確認したい署名を開き、&lt;code>署名の詳細&lt;/code>を開くと署名者の氏名が表示される。&lt;/li>
&lt;li>上状態で&lt;code>証明書の詳細…&lt;/code>をクリックすると証明書の情報を確認でき、ここで市町村のデータなどが閲覧できる。&lt;/li>
&lt;/ul></description></item><item><title>ご自宅統合認証システムを作った話</title><link>https://blog.mkarakiapps.com/p/20210801-homemade-federated-auth/</link><pubDate>Sun, 01 Aug 2021 03:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20210801-homemade-federated-auth/</guid><description>&lt;p>この記事では自宅でLDAP, RADIUS, SAML IdPからなるかんたんな認証システムを作った話をします。
また、おまけとしてRADIUSでインターネット利用状況の取得をした話も書きます。&lt;/p>
&lt;p>今回もメモ要素が強いです。
間違いなどは報告いただけると助かります。&lt;/p>
&lt;h2 id="環境">環境&lt;/h2>
&lt;ul>
&lt;li>Ubuntu 20.04&lt;/li>
&lt;li>hoge.example.com をホスト名に設定&lt;/li>
&lt;li>example.com をドメインとして利用&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>注意:&lt;/strong> この記事ではSuffixなどの書き換え指示を書きません。ご自身で読み替えてください。&lt;/p>
&lt;h2 id="ldap">LDAP&lt;/h2>
&lt;h3 id="ホスト名の設定">ホスト名の設定&lt;/h3>
&lt;p>この手順はスキップすることも出来ますが、統合認証システムのみを動かすホストであれば設定しておいて損はないと思います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo hostnamectl set-hostname hoge.example.com
&lt;/code>&lt;/pre>&lt;/div>&lt;p>また、&lt;code>/etc/hosts&lt;/code>にある旧ホスト名も設定し直してください。&lt;/p>
&lt;h3 id="slapd-ldap-utilsのインストール">slapd, ldap-utilsのインストール&lt;/h3>
&lt;p>必要に応じて&lt;code>sudo apt update&lt;/code>を行ってください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install slapd ldap-utils
&lt;/code>&lt;/pre>&lt;/div>&lt;p>途中で管理者パスワードを設定するように言われるので、思うがままにパスワードを設定してください。&lt;/p>
&lt;blockquote>
&lt;p>管理者アカウントは初期状態で &lt;code>cn=admin,dc=example,dc=com&lt;/code> となります。&lt;br>
ドメイン名を読み替え、メモをしておくことを推奨します&lt;/p>
&lt;/blockquote>
&lt;h4 id="ホスト名の設定をスキップした場合">ホスト名の設定をスキップした場合。&lt;/h4>
&lt;p>ホスト名の設定を行わなかった場合、下記のコマンドを使うことにより手動でドメインの設定を行うことが出来ます。&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo dpkg-reconfigure slapd
&lt;/code>&lt;/pre>&lt;p>設定値は下記の通りです&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">Name&lt;/th>
&lt;th style="text-align:left">Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">Omit OpenLDAP &amp;hellip;&lt;/td>
&lt;td style="text-align:left">No&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">DNS domain name&lt;/td>
&lt;td style="text-align:left">ホスト名のドメイン部（hoge.example.com =&amp;gt; example.com）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Organization name&lt;/td>
&lt;td style="text-align:left">上と同じ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Administrator Password&lt;/td>
&lt;td style="text-align:left">管理者パスワード&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>以降の設定はデフォルト値を利用してください。&lt;/p>
&lt;h3 id="ldapにユーザグループ用のouを追加">LDAPにユーザ・グループ用のOUを追加&lt;/h3>
&lt;p>&lt;code>base.ldif&lt;/code>ファイルを作り、下記の内容を書き込んでください。&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-ldif" data-lang="ldif">dn: ou=people,dc=example,dc=com
objectClass: organizationalUnit
ou: people
dn: ou=groups,dc=example,dc=com
objectClass: organizationalUnit
ou: groups
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="c1"># ldapadd -x -D cn=admin,dc=example,dc=com -W -f base.ldif&lt;/span>
Enter LDAP Password: &amp;lt;管理者パスワードを入力&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="openldapでレプリケーションを設定する">OpenLDAPでレプリケーションを設定する。&lt;/h3>
&lt;h4 id="プロバイダーサーバ-マスターの設定">プロバイダーサーバ (マスター)の設定&lt;/h4>
&lt;p>&lt;code>sync.ldif&lt;/code>のようなファイルを作り、下記の内容を記述します。&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-ldif" data-lang="ldif">dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulePath: /usr/lib/ldap
olcModuleLoad: syncprov.la
dn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
olcSpSessionLog: 100
&lt;/code>&lt;/pre>&lt;p>下記のコマンドで適用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo ldapadd -Y EXTERNAL -H ldapi:/// -f sync.ldif
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="コンシューマーサーバ-スレーブの設定">コンシューマーサーバ (スレーブ)の設定&lt;/h4>
&lt;p>&lt;a class="link" href="#%e3%83%9b%e3%82%b9%e3%83%88%e5%90%8d%e3%81%ae%e8%a8%ad%e5%ae%9a" >ホスト名の設定&lt;/a>と&lt;a class="link" href="#slapd,-ldap-utils%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab" >slapd, ldap-utilsのインストール&lt;/a>まで行ってください。&lt;/p>
&lt;p>&lt;code>sync.ldif&lt;/code>のようなファイルを作り、下記の内容を記述してください。（項目はそれぞれ読み替えてください）&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-ldif" data-lang="ldif">dn: olcDatabase={1}mdb,cn=config
changetype: modify
add: olcSyncRepl
olcSyncRepl: rid=001
provider=ldap://hoge.example.com:389/
bindmethod=simple
binddn=&amp;quot;cn=admin,dc=example,dc=com&amp;quot;
credentials=adminpassword
searchbase=&amp;quot;dc=example,dc=com&amp;quot;
scope=sub
schemachecking=on
type=refreshAndPersist
retry=&amp;quot;30 5 300 3&amp;quot;
interval=00:00:01:00
&lt;/code>&lt;/pre>&lt;p>&lt;code>olcSyncRepl&lt;/code>の詳細&lt;/p>
&lt;ul>
&lt;li>&lt;code>provider&lt;/code> 同期先LDAP&lt;/li>
&lt;li>&lt;code>binddn&lt;/code> 管理者ユーザ名&lt;/li>
&lt;li>&lt;code>credentials&lt;/code> 管理者パスワード&lt;/li>
&lt;li>&lt;code>searchbase&lt;/code> 同期するDN (ドメイン名が良いと思われる)&lt;/li>
&lt;li>&lt;code>retry&lt;/code> 失敗時のリトライ動作 (&lt;code>[&amp;lt;retry interval&amp;gt; &amp;lt;# of retries&amp;gt;]+&lt;/code>)&lt;/li>
&lt;li>&lt;code>interval&lt;/code> 同期間隔 (&lt;code>dd:hh:mm:ss&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>詳細は&lt;a class="link" href="https://www.openldap.org/doc/admin25/slapdconfig.html#syncrepl" target="_blank" rel="noopener"
>LDAP Administrator&amp;rsquo;s Guide&lt;/a>を参照&lt;/p>
&lt;p>下記のコマンドで適用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo ldapadd -Y EXTERNAL -H ldapi:/// -f sync.ldif
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ldap-account-manager">LDAP Account Manager&lt;/h2>
&lt;h3 id="ldap-account-managerのインストール">LDAP Account Managerのインストール&lt;/h3>
&lt;p>まず、Apache2とPHPをインストールします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install apache2 php php-cgi libapache2-mod-php php-mbstring php-common php-pear
&lt;/code>&lt;/pre>&lt;/div>&lt;p>PHPを有効化します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo a2enconf php7.4-cgi
$ sudo systemctl reload apache2
&lt;/code>&lt;/pre>&lt;/div>&lt;p>LDAP Account Managerをインストールします。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo apt -y install ldap-account-manager
&lt;/code>&lt;/pre>&lt;p>&lt;strong>注意:&lt;/strong> インストール時はすべてのホストからの通信を受けるようになっています。
&lt;code>/etc/apache2/conf-enabled/ldap-account-manager.conf&lt;/code>を編集し、アクセス可能ホストを絞ることを強く推奨します。&lt;/p>
&lt;p>関連の設定が終わったらApache2を再起動します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo systemctl restart apache2
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ldap-account-managerの初期設定">LDAP Account Managerの初期設定&lt;/h3>
&lt;p>画像無しでは解説がとても難しいので別の解説サイトを提示します。&lt;/p>
&lt;p>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=8" target="_blank" rel="noopener"
>Ubuntu 20.04 LTS : OpenLDAP : LDAP Account Manager 設定 : Server World&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.server-world.info" target="_blank" rel="noopener"
>Server World&lt;/a> はOS毎に様々なサービスの設定方法を提示しているサイトです。
日本語でわかりやすく書いてありますので、なにか作りたいものがある場合は一度ここを参照してみることをおすすめします。&lt;/p>
&lt;h3 id="wpa2-enterpriseなどのms-chap認証を行いたい場合">WPA2 EnterpriseなどのMS-CHAP認証を行いたい場合&lt;/h3>
&lt;p>&lt;strong>本来設定すべきではありませんが&lt;/strong>、MS-CHAP認証を利用したい場合はパスワードを平文で保管する必要があります。&lt;/p>
&lt;p>&lt;code>Server Settings &amp;gt; Module settings &amp;gt; Unix &amp;gt; Options &amp;gt; Password hash type&lt;/code>
を&lt;code>PLAIN&lt;/code>に設定してください。&lt;/p>
&lt;h2 id="freeradius">FreeRADIUS&lt;/h2>
&lt;h3 id="freeradiusのインストール">FreeRADIUSのインストール&lt;/h3>
&lt;p>ここではLDAPと連携したRADIUSに必要なパッケージをインストールします。
利用状況や課金管理は別の項で解説します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install freeradius freeradius-ldap freeradius-utils
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="freeradiusとldapの連携設定">FreeRADIUSとLDAPの連携設定&lt;/h3>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;p>まず、&lt;code>users&lt;/code>を編集し、LDAP認証に対応させます。
下のコードを追記してください。
また、それ以外のコードはコメントアウトしても構いません。&lt;/p>
&lt;pre tabindex="0">&lt;code>DEFAULT Auth-Type = LDAP
Fall-Through = 1
&lt;/code>&lt;/pre>&lt;p>次にldapのmodを有効化します。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo ln -s /etc/freeradius/3.0/mods-available/ldap /etc/freeradius/3.0/mods-enabled/ldap
&lt;/code>&lt;/pre>&lt;p>&lt;code>mods-enabled/ldap&lt;/code>を編集し、LDAP接続先を設定します。&lt;/p>
&lt;ul>
&lt;li>19行目あたり &lt;code>server = ''&lt;/code>でサーバを設定します&lt;/li>
&lt;li>28行目あたり &lt;code>identity = ''&lt;/code>に管理者アカウントを設定します&lt;/li>
&lt;li>29行目あたり &lt;code>password = ''&lt;/code>に管理者パスワードを設定します&lt;/li>
&lt;li>33行目あたり &lt;code>base_dn = ''&lt;/code>に検索対象のDNを設定します。
この記事通りの設定の場合、&lt;code>ou=people,dc=example,dc=com&lt;/code>となります。&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sites-enabled/default&lt;/code>と&lt;code>sites-enabled/inner-tunnel&lt;/code>を編集し、ldapを有効にします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>authorize&lt;/code>セクション内の&lt;code>ldap&lt;/code>のコメントアウトを外します&lt;/li>
&lt;li>&lt;code>authenticate&lt;/code>セクション内の&lt;code>Auth-Type LDAP&lt;/code>セクションのコメントアウトをすべて外します&lt;/li>
&lt;li>&amp;lsquo;post-auth&amp;rsquo;セクションの&lt;code>ldap&lt;/code>のコメントアウトを外します&lt;/li>
&lt;/ul>
&lt;p>以上で連携設定は完了です。
必要に応じてClientを設定してください。
すべての設定が終わったらFreeRADIUSを再起動して設定を読み込ませてください。&lt;/p>
&lt;h3 id="freeradiusでeap-peapms-chapv2を設定する">FreeRADIUSでEAP-PEAP/MS-CHAPv2を設定する&lt;/h3>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;h4 id="eap用の証明書を生成">EAP用の証明書を生成&lt;/h4>
&lt;p>私は&lt;a class="link" href="https://letsencrypt.org/" target="_blank" rel="noopener"
>Let&amp;rsquo;s Encrypt&lt;/a>を利用しました。
注意点として、証明書ファイルの所有者を&lt;code>freerad:freerad&lt;/code>に設定しておかないとFreeRADIUSから読み込めなくなります。&lt;/p>
&lt;h4 id="freeradiusの設定">FreeRADIUSの設定&lt;/h4>
&lt;p>&lt;code>mods-enabled/eap&lt;/code>を編集します。&lt;/p>
&lt;ul>
&lt;li>&lt;code>eap&lt;/code>セクション&lt;code>default_eap_type&lt;/code>を&lt;code>peap&lt;/code>に設定&lt;/li>
&lt;li>&lt;code>eap&lt;/code>セクション内&lt;code>peap&lt;/code>セクションの&lt;code>use_tunneled_reply&lt;/code>を&lt;code>yes&lt;/code>に&lt;/li>
&lt;li>&lt;code>eap&lt;/code>セクション内&lt;code>tls-config til-common&lt;/code>セクションの下記の項目を変更してください。
&lt;ul>
&lt;li>&lt;code>private_key_password&lt;/code> 秘密鍵のパスワードを指定します。Let&amp;rsquo;s encryptの場合は無視して大丈夫です。&lt;/li>
&lt;li>&lt;code>private_key_file&lt;/code> 秘密鍵のファイルを指定してください。Let&amp;rsquo;s encryptでは&lt;code>privkey.pem&lt;/code>が該当します。&lt;/li>
&lt;li>&lt;code>certificate_file&lt;/code> 証明書ファイルを指定してください。 Let&amp;rsquo;s encryptでは&lt;code>fullchain.pem&lt;/code>が該当します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="注意事項">注意事項&lt;/h4>
&lt;p>MS-CHAPv2で認証をする際は、LDAP側に平文でパスワードが保管されている必要があります。
パスワードの取り扱いには十分注意してください。&lt;/p>
&lt;h3 id="freeradius側でrealmに応じてvlanを切り替える">FreeRADIUS側でRealmに応じてVlanを切り替える&lt;/h3>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;p>&lt;code>proxy.conf&lt;/code>にRealmを設定します。
設定値にstripを付けることで、LDAP側に問い合わせるユーザ名からRealm部を削除します。&lt;/p>
&lt;pre tabindex="0">&lt;code>realm hoge.fuga {
strip
}
&lt;/code>&lt;/pre>&lt;p>&lt;code>users&lt;/code>に付与したいVLANを記述します。同じ方法でその他のAttributeも付与できます。&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf"># Realmが一致している場合にVLANを割り振る
DEFAULT Realm == &amp;quot;hoge.fuga&amp;quot;
Tunnel-Type = 13,
Tunnel-Medium-Type = 6,
Tunnel-Private-Group-Id = 100
# ユーザ名とRealmが一致している場合にVLANを割り振る
DEFAULT User-Name == &amp;quot;user@hoge.fuga&amp;quot;
Tunnel-Type = 13,
Tunnel-Medium-Type = 6,
Tunnel-Private-Group-Id = 100
&lt;/code>&lt;/pre>&lt;h4 id="課金システムで表示されるユーザ名を一致させたい">課金システムで表示されるユーザ名を一致させたい&lt;/h4>
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf"> User-Name = &amp;quot;user&amp;quot;,
&lt;/code>&lt;/pre>&lt;p>を&lt;code>DEFAULT&lt;/code>行の下に挿入してください。&lt;/p>
&lt;h3 id="radiusで課金管理-accounting-を行う">RADIUSで課金管理 (Accounting) を行う&lt;/h3>
&lt;h4 id="mysqlを設定する">MySQLを設定する&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install mysql-server
&lt;/code>&lt;/pre>&lt;/div>&lt;p>必要に応じて&lt;code>sudo mysql_secure_installation&lt;/code>を使い設定を行ってください。
今回は完全に閉鎖された空間で利用することを前提にこの設定を行いません。&lt;/p>
&lt;p>もし、rootパスワードを設定した場合、記事内の&lt;code>mysql -u root&lt;/code>を&lt;code>mysql -u root -p&lt;/code>に読み替えてください。&lt;/p>
&lt;p>&lt;code>sudo mysql -u root&lt;/code>でMySQLに入り以下のSQLを投入してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DATABASE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="k">GRANT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">localhost&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IDENTIFIED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;radius&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="n">FLUSH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIVILEGES&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="n">QUIT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>注意:&lt;/strong> 今回のインストール例ではRADIUS用アカウントのパスワードを&lt;code>radius&lt;/code>に設定しています。
これは非常に脆弱なパスワードであり、強固なパスワードに設定し直すことを強く推奨します。&lt;/p>
&lt;p>Root権限で下記のコマンドを実行します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="c1"># mysql -u root radius &amp;lt; /etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>下記の内容でsqlファイルを作成し、上記の方法でradiusデータベースに適応させてください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radacct&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radacct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radacctid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessionid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctuniqueid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">groupname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realm&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasportid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasporttype&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctupdatetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctinterval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessiontime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unsigned&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctauthentic&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connectinfo_start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connectinfo_stop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctinputoctets&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctoutputoctets&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">calledstationid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">callingstationid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctterminatecause&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">servicetype&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedprotocol&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6address&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedinterfaceid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">44&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegatedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">class&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">radacctid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UNIQUE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctuniqueid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctuniqueid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedipaddress&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6address&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedipv6address&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedipv6prefix&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedinterfaceid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedinterfaceid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegatedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegatedipv6prefix&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessionid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctsessionid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessiontime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctsessiontime&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctinterval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctinterval&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bulk_close&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ENGINE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">INNODB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>情報:&lt;/strong> 私がインストールを試みた際は、&lt;code>/etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql&lt;/code>に不具合があり、&lt;a class="link" href="https://github.com/FreeRADIUS/freeradius-server/blob/master/raddb/mods-config/sql/main/mysql/schema.sql" target="_blank" rel="noopener"
>GitHubに存在する正しいスキーマ&lt;/a>を適用し、間違っているテーブルを削除しました。&lt;br>
この不具合は一時的なものであると考えられるため、記事の閲覧時にこの手順が必要ない可能性が高いです。
また、今回修正したのは最低限課金情報取得に必要なテーブルであり、その他のテーブルにも不具合がある可能性があります。&lt;br>
不具合があった場合はFreeRADIUSを終了させ、&lt;code>sudo freeradius -X&lt;/code>を実行し、エラーを確認してください。&lt;/p>
&lt;h4 id="freeradiusをmysqlに対応させる">FreeRADIUSをMySQLに対応させる&lt;/h4>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;p>sql関係のパッケージをインストールします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install freeradius-mysql
&lt;/code>&lt;/pre>&lt;/div>&lt;p>次に、sqlのmodを有効化します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo ln -s /etc/freeradius/3.0/mods-available/sql /etc/freeradius/3.0/mods-enabled/
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>mods-enabled/sql&lt;/code>を編集し、SQL接続情報を記述します。&lt;/p>
&lt;ul>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>dialect&lt;/code>を&lt;code>mysql&lt;/code>に設定&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>driver&lt;/code>を&lt;code>rlm_sql_${dialect}&lt;/code>に設定&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクジョン下の&lt;code>mysql&lt;/code>セクションに存在する&lt;code>tls&lt;/code>セクション全体をコメントアウト&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>server&lt;/code>, &lt;code>port&lt;/code>を必要に応じて変更&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>login&lt;/code>, &lt;code>password&lt;/code>を前の項で設定したユーザ名、パスワードに設定&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sites-enabled/default&lt;/code>を編集し、課金情報をMySQLに保管する設定にします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>accounting&lt;/code>セクション内の&lt;code>sql&lt;/code>をコメントアウトします&lt;/li>
&lt;/ul>
&lt;h4 id="daloradiusをインストールする">daloRADIUSをインストールする&lt;/h4>
&lt;p>今回daloRADIUSは課金情報確認の為だけにインストールします。&lt;/p>
&lt;p>前提パッケージをインストールします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install php libapache2-mod-php php-&lt;span class="o">{&lt;/span>gd,common,mail,mail-mime,mysql,pear,db,mbstring,xml,curl&lt;span class="o">}&lt;/span> unzip
&lt;/code>&lt;/pre>&lt;/div>&lt;p>daloRADIUSをダウンロードし、&lt;code>/var/www/html&lt;/code>に展開します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ wget https://github.com/lirantal/daloradius/archive/master.zip
$ unzip master.zip
$ sudo mv daloradius-master /var/www/html/daloradius
&lt;/code>&lt;/pre>&lt;/div>&lt;p>MySQLに必要なテーブルを挿入します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo mysql -u root radius &amp;lt; /var/www/html/daloradius/contrib/db/fr2-mysql-daloradius-and-freeradius.sql
$ sudo mysql -u root radius &amp;lt; /var/www/html/daloradius/contrib/db/mysql-daloradius.sql
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>/var/www/html/daloradius/library/daloradius.conf.php&lt;/code>を編集し、MySQLへのアクセス情報を設定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_HOST&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># MySQLのホストを設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_PORT&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;3306&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># MySQLのポートを設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_USER&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;radius&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># ユーザ名を設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_PASS&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;radius&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># パスワードを設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_NAME&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;radius&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># データベース名を設定
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これでdaloRADIUSのインストールは終了です。
初期パスワードは&lt;code>radius&lt;/code>です。&lt;/p>
&lt;h2 id="saml-idp">SAML IdP&lt;/h2>
&lt;p>SimpleSAMLphpを利用し、SAML IdPを行います。&lt;br>
RSAのSSL証明書が必要になります。私は&lt;a class="link" href="https://letsencrypt.org/" target="_blank" rel="noopener"
>Let&amp;rsquo;s encrypt&lt;/a>を使いました。&lt;/p>
&lt;h3 id="simplesamlidpをインストール">SimpleSAMLIdPをインストール&lt;/h3>
&lt;p>下記のコマンドでインストールと有効化を行います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo apt -y install simplesamlphp
$ sudo a2enconf simplesamlphp
$ sudo service apache2 restart
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="simplesamlidpを設定">SimpleSAMLIdPを設定&lt;/h3>
&lt;p>&lt;code>/var/lib/simplesamlphp/secrets.inc.php&lt;/code>を編集し、管理者パスワードを設定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;span class="nv">$config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;auth.adminpassword&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nv">$config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;secretsalt&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;SALT&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// この項目は初期状態にしておくべきです。
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>/usr/share/simplesamlphp/config/config.php&lt;/code>を編集し、設定を行います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php"> &lt;span class="c1">// 前略
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;admin.protectindexpage&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// ログインしていないとサーバ情報が見れないようにする
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;admin.protectmetadata&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 同上
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">// 中略
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;enable.saml20-idp&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// SAML2.0 IdPを有効化
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">// 後略
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>/usr/share/simplesamlphp/config/authsources.php&lt;/code>を編集し、LDAPへの接続情報を記述します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php"> &lt;span class="c1">// 前略
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;example-ldap&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="c1">// `example-ldap` はお好みで変更可能です
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;ldap:LDAP&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;hostname&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;ldap://hoge.example.com&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;enable_tls&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;timeout&amp;#39;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">389&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;dnpattern&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;uid=%username%,ou=people,dc=example,dc=com&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 検索対象のDNと検索パターンを指定
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">// 入力されたユーザ名が`%username%`に入る。uid=やcn=として検索パターンを指定できる。
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;search.enable&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;search.base&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;ou=people,dc=example,dc=com&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 検索対象DN
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;search.attributes&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;uid&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;mail&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1">// 検索対象の属性
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;search.username&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;search.password&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">),&lt;/span>
&lt;span class="c1">// 後略
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>かなりコンフィグを省略しましたが、概ねこの様になっていれば大丈夫です。&lt;/p>
&lt;p>次に&lt;code>/usr/share/simplesamlphp/config/metadata/saml20-idp-hosted.php&lt;/code>を編集してIdPの設定を行います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="nx">php&lt;/span>
&lt;span class="nv">$metadata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__DYNAMIC:1__&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="cm">/*
&lt;/span>&lt;span class="cm"> * * The hostname for this IdP. This makes it possible to run multiple
&lt;/span>&lt;span class="cm"> * * IdPs from the same configuration. &amp;#39;__DEFAULT__&amp;#39; means that this one
&lt;/span>&lt;span class="cm"> * * should be used by default.
&lt;/span>&lt;span class="cm"> * */&lt;/span>
&lt;span class="s1">&amp;#39;host&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;__DEFAULT__&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="cm">/*
&lt;/span>&lt;span class="cm"> * * The private key and certificate to use when signing responses.
&lt;/span>&lt;span class="cm"> * * These are stored in the cert-directory.
&lt;/span>&lt;span class="cm"> * */&lt;/span>
&lt;span class="s1">&amp;#39;privatekey&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;/usr/share/simplesamlphp/config/privkey.pem&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// SSL秘密鍵
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="s1">&amp;#39;certificate&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;/usr/share/simplesamlphp/config/fullchain.pem&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// SSL証明書
&lt;/span>&lt;span class="c1">&lt;/span>
&lt;span class="cm">/*
&lt;/span>&lt;span class="cm"> * * The authentication source which should be used to authenticate the
&lt;/span>&lt;span class="cm"> * * user. This must match one of the entries in config/authsources.php.
&lt;/span>&lt;span class="cm"> * */&lt;/span>
&lt;span class="s1">&amp;#39;auth&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;example-ldap&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 先程`example-ldap`を書き換えた場合はこちらも書き換えてください。
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>この後はSPを&lt;code>/usr/share/simplesamlphp/config/metadata/saml20-sp-remote.php&lt;/code>に記述し、IdPの情報をSPに登録する処理になりますが、この記事では取り扱いません。&lt;/p>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://computingforgeeks.com/install-and-configure-openldap-server-ubuntu/" target="_blank" rel="noopener"
>https://computingforgeeks.com/install-and-configure-openldap-server-ubuntu/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://qiita.com/cffnpwr/items/be903005e291d0ece514" target="_blank" rel="noopener"
>https://qiita.com/cffnpwr/items/be903005e291d0ece514&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=1" target="_blank" rel="noopener"
>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=openldap&amp;f=1&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=8" target="_blank" rel="noopener"
>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=openldap&amp;f=8&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://computingforgeeks.com/how-to-install-freeradius-and-daloradius-on-ubuntu/" target="_blank" rel="noopener"
>https://computingforgeeks.com/how-to-install-freeradius-and-daloradius-on-ubuntu/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://qiita.com/bashaway/items/c96a2b14c46acd8cdc40" target="_blank" rel="noopener"
>https://qiita.com/bashaway/items/c96a2b14c46acd8cdc40&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.casleyconsulting.co.jp/blog/engineer/230/" target="_blank" rel="noopener"
>https://www.casleyconsulting.co.jp/blog/engineer/230/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://mx.eduroam.jp/docs/conf-freeradius.html" target="_blank" rel="noopener"
>http://mx.eduroam.jp/docs/conf-freeradius.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://networklab.sub.jp/lab/network/wifi/201502/476/" target="_blank" rel="noopener"
>http://networklab.sub.jp/lab/network/wifi/201502/476/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.nii.ac.jp/openforum/upload/20190529PM_Auth_03_Suenaga.pdf" target="_blank" rel="noopener"
>https://www.nii.ac.jp/openforum/upload/20190529PM_Auth_03_Suenaga.pdf&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://techexpert.tips/ja/freeradius-ja/ubuntu-linux%E3%81%A7%E3%81%AEmysql%E7%B5%B1%E5%90%88%E3%81%A8freeradius%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" target="_blank" rel="noopener"
>https://techexpert.tips/ja/freeradius-ja/ubuntu-linux%E3%81%A7%E3%81%AEmysql%E7%B5%B1%E5%90%88%E3%81%A8freeradius%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/FreeRADIUS/freeradius-server/blob/master/raddb/mods-config/sql/main/mysql/schema.sql" target="_blank" rel="noopener"
>https://github.com/FreeRADIUS/freeradius-server/blob/master/raddb/mods-config/sql/main/mysql/schema.sql&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=6" target="_blank" rel="noopener"
>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=openldap&amp;f=6&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.openldap.org/doc/admin25/slapdconfig.html#syncrepl" target="_blank" rel="noopener"
>https://www.openldap.org/doc/admin25/slapdconfig.html#syncrepl&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.secioss.co.jp/simplesamlphp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6ad%E8%AA%8D%E8%A8%BC%E3%81%99%E3%82%8Bsaml-idp%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86/" target="_blank" rel="noopener"
>https://www.secioss.co.jp/simplesamlphp%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6ad%E8%AA%8D%E8%A8%BC%E3%81%99%E3%82%8Bsaml-idp%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://simplesamlphp.org/docs/stable/ldap:ldap" target="_blank" rel="noopener"
>https://simplesamlphp.org/docs/stable/ldap:ldap&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://simplesamlphp.org/docs/stable/simplesamlphp-idp" target="_blank" rel="noopener"
>https://simplesamlphp.org/docs/stable/simplesamlphp-idp&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>無料で使えるインターネット関連サービス一覧</title><link>https://blog.mkarakiapps.com/p/20210720-free-inet-services/</link><pubDate>Mon, 19 Jul 2021 15:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20210720-free-inet-services/</guid><description>&lt;p>この記事は別のサイトと連携している記事です。&lt;/p>
&lt;p>常に金欠な私が見つけた無料でいい感じのサービスをメモがてら書いていきます。&lt;/p>
&lt;h2 id="認証系">認証系&lt;/h2>
&lt;h3 id="jumpcloudhttpsjumpcloudcom">&lt;a class="link" href="https://jumpcloud.com/" target="_blank" rel="noopener"
>JumpCloud&lt;/a>&lt;/h3>
&lt;p>　認証系サービスとしてかなり優秀で、10ユーザまでLDAPやRADIUSが使え、独自の認証連携ソフトウェア上で10デバイスまで無料でほぼフル機能がついています。おまけに最初の10日間は24時間365日チャットサポートが有るという素晴らしい待遇。&lt;/p>
&lt;p>　サポートを実際に私も受けましたが、画面共有をしながら状況の確認を行っていただき、かなり親切で丁寧な印象を受けました。また、どうやら10日を超えてもフォームでサポートを受けれる気がします。（未確認）&lt;/p>
&lt;p>　ご自宅 WPA2 EnterpriseやZabbix LDAPなどをやってみたい方は一度試してみてもいいと思います。&lt;/p>
&lt;h3 id="azure-active-directoryhttpsazuremicrosoftcomja-jpservicesactive-directory">&lt;a class="link" href="https://azure.microsoft.com/ja-jp/services/active-directory/" target="_blank" rel="noopener"
>Azure Active Directory&lt;/a>&lt;/h3>
&lt;p>　こちらはSSOとActive Directoryにおいてかなり優秀なシステムです。ローカルのActive Directoryと連携できるAzure AD Connectも無料で使える上、Windows 10 Proなどで使えるAzure ADログインに対応しています（当たり前の話ですが）。いつの間にかSSOも無制限になっており、ユーザもある程度入れられたと記憶しています（具体的な数を調べられなかった）&lt;/p>
&lt;p>　JumpCloudと連携することでJumpCloud側の制限である10ユーザまでRadiusやLDAPを利用できるようになります。&lt;/p>
&lt;h3 id="cloudflare-accesshttpswwwcloudflarecomja-jpteamsaccess">&lt;a class="link" href="https://www.cloudflare.com/ja-jp/teams/access/" target="_blank" rel="noopener"
>Cloudflare Access&lt;/a>&lt;/h3>
&lt;p>　自分がホストしているWebサービスなどにアクセスする際にメールアドレス認証やSSOをかませる事ができるサービスです。&lt;/p>
&lt;p>　例えばGrafanaのWebコンソールにアクセスできるユーザを先に紹介しているAzure ADなどで制限することが出来ます。アクセス元はCloudflareのIP扱いになるので、それだけをファイアウォールで許可することである程度安全な環境を作ることが出来ます（ただし、監視などの通信についてはよく考える必要性がありますが）&lt;/p>
&lt;h2 id="cdn">CDN&lt;/h2>
&lt;h3 id="cloudflarehttpswwwcloudflarecom">&lt;a class="link" href="https://www.cloudflare.com/" target="_blank" rel="noopener"
>Cloudflare&lt;/a>&lt;/h3>
&lt;p>　定番ですが一応紹介しておきます。CDNとして使えますし、IPv6やIPv4非対応ホストにそれぞれのIPを作ってあげる用途で使うことも一応可能です。また、SSL非対応のホストに外見だけSSLを渡すことも出来ます（Cloudflareとホスト間の通信は暗号化されないので注意）&lt;/p>
&lt;h2 id="vps">VPS&lt;/h2>
&lt;h3 id="oracle-cloud-free-tier---compute-vmhttpswwworaclecomjpcloudfree">&lt;a class="link" href="https://www.oracle.com/jp/cloud/free/" target="_blank" rel="noopener"
>Oracle Cloud Free Tier - Compute VM&lt;/a>&lt;/h3>
&lt;p>　1/8 OCPUと1GBメモリを搭載している2つのVMを使えます。私はここにVPNとZabbixを置いています。かなり快適ですし、これが無料なのは信じられないレベルです。&lt;/p>
&lt;h2 id="web-server">Web Server&lt;/h2>
&lt;h3 id="github-pageshttpspagesgithubcom">&lt;a class="link" href="https://pages.github.com/" target="_blank" rel="noopener"
>GitHub Pages&lt;/a>&lt;/h3>
&lt;p>　GitHubが提供する静的サイト限定のサービスです。標準でJekyllに対応している他、GitHub Actionsと合わせることでHugoなどのビルドも自動化出来ます。&lt;/p>
&lt;p>　SSLや独自ドメイン（サブドメイン含む）に対応していますが、ホストするコンテンツが1GB以内である、1ヶ月に100GBまで、1時間に10ビルドまでなどの制限があるそうです。（&lt;a class="link" href="https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages#usage-limits" target="_blank" rel="noopener"
>About GitHub Pages - GitHub Docs&lt;/a>）&lt;/p>
&lt;h3 id="xreahttpswwwxreacom">&lt;a class="link" href="https://www.xrea.com/" target="_blank" rel="noopener"
>XREA&lt;/a>&lt;/h3>
&lt;p>　GMOが提供するレンタルサーバです。スペックは下記の通り。&lt;/p>
&lt;ul>
&lt;li>1GB のストレージ&lt;/li>
&lt;li>マルチドメイン（10個）&lt;/li>
&lt;li>1GB/Day の転送量&lt;/li>
&lt;li>WordPress利用可能&lt;/li>
&lt;li>チャットサポート&lt;/li>
&lt;li>CGI/SSI/Perl/PHP/Ruby対応&lt;/li>
&lt;li>SSL対応（独自、Let&amp;rsquo;s encrypt）&lt;/li>
&lt;li>&lt;strong>広告が表示されます&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>　また、メインではないのでしょうが、一応100個までメールアドレスを発行できるため、メールサーバとしても使えます。一日あたり1,000通もメールをメールを送ることは無いでしょうから十分だと思っています。&lt;/p>
&lt;h3 id="starserver-freehttpswwwstarnejpfree">&lt;a class="link" href="https://www.star.ne.jp/free/" target="_blank" rel="noopener"
>StarServer Free&lt;/a>&lt;/h3>
&lt;p>　Netowlの提供するレンタルサーバです。プランは下記のとおりです。&lt;/p>
&lt;ul>
&lt;li>2GB 広告無し&lt;/li>
&lt;li>4GB&lt;/li>
&lt;li>2GB PHP, MySQL(50MB)&lt;/li>
&lt;/ul>
&lt;p>　一番上のプラン以外はスマートフォンアクセス時にのみ広告が表示されます。難点として、SSL非対応です。また、ドメインを1つ追加できると謳っていますが、TLDにかなり厳しい制限があり、それ以外を利用するには有料プランにしなければならないとのこと。&lt;/p>
&lt;p>　個人的には静的なサイトを2GBプランを使ってCloudflareを噛ませて公開するのに丁度いいと思っています。&lt;/p>
&lt;h3 id="xfreehttpswwwxfreenejp">&lt;a class="link" href="https://www.xfree.ne.jp/" target="_blank" rel="noopener"
>XFREE&lt;/a>&lt;/h3>
&lt;p>　Xserverが提供するレンタルサーバです。プランは下記の通り。&lt;/p>
&lt;ul>
&lt;li>1GB 広告無し（条件付き）&lt;/li>
&lt;li>1GB PHP, MySQL(50MB)&lt;/li>
&lt;li>2GB WordPress (DB: 100MB)&lt;/li>
&lt;/ul>
&lt;p>　一番上のプランは3ヶ月以上ファイルを変更する動作をしていない場合に広告表示、それ以外は常時のようです。独自のドメインは10個とのことですが、私が試した限りStarServer Freeと同じようにリストに無いTLDを持つドメインは追加できません。こちらもSSL非対応です。&lt;/p>
&lt;p>　使い道としてはStarServer Freeと同じ感じになると思います。&lt;/p>
&lt;h2 id="dns">DNS&lt;/h2>
&lt;h3 id="cloudflarehttpswwwcloudflarecom-1">&lt;a class="link" href="https://www.cloudflare.com/" target="_blank" rel="noopener"
>Cloudflare&lt;/a>&lt;/h3>
&lt;p>　Webが関連するところにはだいたい現れるであろうCloudflareです。DNSツールとしてかなり使いやすく、対応しているサービスをホストするのであればIPを隠す事もできます。&lt;/p>
&lt;p>　アカウントの共有機能を使って大きなプロジェクトのDNSを複数人で管理したり、APIを使って動作を自動化したりも可能です（応用してDDNSのような使い方もできます）&lt;/p>
&lt;p>　対応しているドメインであればDNSSECなどのセキュリティ機能もありますし、格安の&lt;a class="link" href="https://www.cloudflare.com/ja-jp/products/registrar/" target="_blank" rel="noopener"
>Cloudflare Registrar&lt;/a>が利用可能な場合は、何も考えずにここに載せてもいいと思っています。&lt;/p>
&lt;h3 id="hurricane-electric-free-dns-managementhttpsdnshenet">&lt;a class="link" href="https://dns.he.net/" target="_blank" rel="noopener"
>Hurricane Electric Free DNS Management&lt;/a>&lt;/h3>
&lt;p>　Hurricane Electricが提供しているDNSです。DDNSに対応しているサービスで、かなりわかりやすい部類だと思います。DNS機能としては細かい制限がありますがクリティカルなものは無かったと思います。&lt;/p>
&lt;h2 id="email-forward">Email Forward&lt;/h2>
&lt;h3 id="improvmxhttpsimprovmxcom">&lt;a class="link" href="https://improvmx.com/" target="_blank" rel="noopener"
>ImprovMX&lt;/a>&lt;/h3>
&lt;p>　特定のドメインに来たメールすべてを特定のアドレスに転送できる凄い奴です。制限として、独自に転送先を変更できるアドレスは25個までであることと、10Mbまでの添付ファイルまでしか受け付けてくれないことがあります。&lt;/p>
&lt;h2 id="email-delivery">Email Delivery&lt;/h2>
&lt;h3 id="mailjethttpswwwmailjetcom">&lt;a class="link" href="https://www.mailjet.com/" target="_blank" rel="noopener"
>Mailjet&lt;/a>&lt;/h3>
&lt;p>　メールの送信サービスです。独自ドメインなどからメールを送信したい場合にとても重宝します（私はZabbixのアラートに使っています）。1日に200通までしか送れませんが、そこまで使うことはないと思います。（というか、1日にアラート200件来たら諦めてサーバの電源引っこ抜く）&lt;/p>
&lt;p>　APIを使ってメール送信もできるので、様々なサービスと連携ができそうです。&lt;/p>
&lt;h2 id="vpn">VPN&lt;/h2>
&lt;h3 id="tailscalehttpstailscalecom">&lt;a class="link" href="https://tailscale.com/" target="_blank" rel="noopener"
>Tailscale&lt;/a>&lt;/h3>
&lt;p>　外向きの通信が通れば大体使えるすごいやつです。無料版だと20デバイスまで接続できるとのこと。（私が初めて見たときには100だった気がする）サブネットルーティングなどが使えるためかなり便利なサービスです。（しかし、現在無料で使えるサービスにかなりの制限がかかっているので、Oracle CloudにSoftEther VPN置いたほうが良さそうと思ったり…）&lt;/p>
&lt;h3 id="vpn-azurehttpwwwvpnazurenetja">&lt;a class="link" href="http://www.vpnazure.net/ja/" target="_blank" rel="noopener"
>VPN Azure&lt;/a>&lt;/h3>
&lt;p>　SoftEther VPNに置いて、NAPTやファイアウォール超えをするときにとても重宝するサービスです。前提としてSoftEther VPN Serverを建てる必要がありますが、Oracle Cloudの無料枠などに置くと完全無料でいい感じのVPNが作れます。注意点として、内部に用意する仮想ネットワークはv6非対応です。L2 VPNではv6をつかうことが出来ます。&lt;/p></description></item><item><title>（今更）ブログをはじめました</title><link>https://blog.mkarakiapps.com/p/first-post/</link><pubDate>Sat, 22 May 2021 13:57:09 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/first-post/</guid><description>&lt;p>文字通りブログ環境を構築しました。 過去にQiitaに上げた記事のうちいくつかのコピーして上げています。&lt;/p></description></item><item><title>Oracle Cloudのminimal UbuntuのInstanceで外からつながらない問題</title><link>https://blog.mkarakiapps.com/p/20210206-oraclecloud-ubuntu-inbound-firewall/</link><pubDate>Fri, 05 Feb 2021 15:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20210206-oraclecloud-ubuntu-inbound-firewall/</guid><description>&lt;p>自分用のメモです。&lt;/p>
&lt;h1 id="環境">環境&lt;/h1>
&lt;ul>
&lt;li>Oracle Cloudインスタンス&lt;/li>
&lt;li>Image: Canonical-Ubuntu-20.04-Minimal-2020.12.10-0&lt;/li>
&lt;li>Shape: VM.Standard.E2.1.Micro&lt;/li>
&lt;/ul>
&lt;h1 id="原因">原因&lt;/h1>
&lt;p>iptablesのルールである&lt;/p>
&lt;pre tabindex="0">&lt;code>-A INPUT -j REJECT --reject-with icmp-host-prohibited
&lt;/code>&lt;/pre>&lt;h1 id="解決策">解決策&lt;/h1>
&lt;pre tabindex="0">&lt;code>/etc/iptables/rules.v4
&lt;/code>&lt;/pre>&lt;p>の17行目にある&lt;/p>
&lt;pre tabindex="0">&lt;code>-A INPUT -j REJECT --reject-with icmp-host-prohibited
&lt;/code>&lt;/pre>&lt;p>をコメントアウトして再起動。（すべてのポートが晒されるので注意）&lt;/p></description></item><item><title>Windows 10をUSBメモリなどに手動でインストールする方法</title><link>https://blog.mkarakiapps.com/p/20201227-win10-on-usb/</link><pubDate>Sun, 27 Dec 2020 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20201227-win10-on-usb/</guid><description>&lt;h1 id="まえがき">まえがき&lt;/h1>
&lt;p>かなり前の話になりますが、株式会社アーク情報システムということろが「BOOT革命/USB」という製品を作っていました。
この製品は、WindowsをUSBに入れる事ができることを売りにしていたソフトで、私は全く使いませんでしたが一応持ってはいました。
今回、SSDの代わりに低容量のUSBメモリを臨時で使いたいという問い合わせがあり、私なりに方法を探ったのでメモとして残します。&lt;/p>
&lt;h1 id="注意">注意&lt;/h1>
&lt;p>この記事で紹介する動作について、一切の責任を負いませんので予めご了承ください。
もし、この記事を参考にし作業する際は、自己責任でお願いします。&lt;/p>
&lt;h1 id="検証環境">検証環境&lt;/h1>
&lt;ul>
&lt;li>Windows 10 Home x64 (ビルド不明)&lt;/li>
&lt;li>VMWare Workstation 16 Player&lt;/li>
&lt;/ul>
&lt;h1 id="手順">手順&lt;/h1>
&lt;h2 id="パーティションの設定">パーティションの設定&lt;/h2>
&lt;p>Windows 10の場合、基本的にパーティションは3つ生成されます。
しかし、1つは回復領域であるため無視し、EFI用とシステム用の2つのみで構成しようと思います。&lt;/p>
&lt;p>パーティションは以下のようになります。&lt;/p>
&lt;ol>
&lt;li>200MB-500MB程度 FAT32 Active&lt;/li>
&lt;li>残りの容量 NTFS&lt;/li>
&lt;/ol>
&lt;p>設定方法は解説しませんがActiveにする方法として、&lt;code>diskpart&lt;/code>でパーティションを選択し&lt;code>active&lt;/code>コマンドを打つ方法があります。&lt;/p>
&lt;p>設定する上で2つのパーティションにドライブレターが割り当てられている必要があります。ここから先の手順では、上からそれぞれ&lt;code>E:&lt;/code>と&lt;code>F:&lt;/code>が割り当てられているとします。&lt;/p>
&lt;h2 id="イメージの展開">イメージの展開&lt;/h2>
&lt;p>一般のキッティングにも使われているであろう&lt;code>Dism&lt;/code>を使います。事前にWindows 10のインストールメディア内の&lt;code>sources/install.esd&lt;/code>を抽出してください。
此処から先の工程では、作業ディレクトリ内に抽出した&lt;code>install.esd&lt;/code>が存在し、アクセス権がある状態を想定し記載します。&lt;/p>
&lt;h3 id="イメージidを調べる">イメージIDを調べる&lt;/h3>
&lt;p>管理者権限のPowerShellもしくはコマンドプロンプトで次のコマンドを入力します。&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-plaintext:PowerShell（管理者）" data-lang="plaintext:PowerShell（管理者）">&amp;gt; Dism /Get-WimInfo /WimFile:install.esd
&lt;/code>&lt;/pre>&lt;p>希望するエディションのインデックスを覚えておいてください。
此処から先では、&lt;code>Windows 10 Home（インデックス: 1）&lt;/code>をインストールする前提で記載していきます。&lt;/p>
&lt;h3 id="イメージを展開する">イメージを展開する&lt;/h3>
&lt;p>イメージを展開します。&lt;code>/Index:&lt;/code>と&lt;code>/ApplyDir:&lt;/code>は各自の環境に応じて変更してください。&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-plaintext:PowerShell（管理者）" data-lang="plaintext:PowerShell（管理者）">&amp;gt; Dism /Apply-Image /ImageFile:install.esd /Index:1 /ApplyDir:F:\
&lt;/code>&lt;/pre>&lt;h3 id="ブートローダーの設定">ブートローダーの設定&lt;/h3>
&lt;p>&lt;code>bcdboot&lt;/code>を使用し、ブートローダーを設定します。各自で&lt;code>E:\Windows&lt;/code>、&lt;code>/l ja-JP&lt;/code>、&lt;code>/s E:&lt;/code>については読み替えてください。
また、&lt;code>/l ja-JP&lt;/code>はなくても動くはずです。&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-plaintext:PowerShell（管理者）" data-lang="plaintext:PowerShell（管理者）">&amp;gt; bcdboot F:\Windows /l ja-JP /s E: /f ALL
&lt;/code>&lt;/pre>&lt;h3 id="設定oobe">設定（OOBE）&lt;/h3>
&lt;p>あとはUSBメモリからブートし、普通に設定をしていくだけです。&lt;/p>
&lt;h1 id="参考">参考&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="http://ohaohaoha.cocolog-nifty.com/blog/2015/08/windows-to-go-f.html" target="_blank" rel="noopener"
>Windows To Goを作る: おはのおはなし&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di" target="_blank" rel="noopener"
>BCDBoot のコマンド ライン オプション | Microsoft Docs&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>docomo らくらくホン F-02J 物理ボタンのキーコード一覧</title><link>https://blog.mkarakiapps.com/p/docomo-f02j-button-keycodes/</link><pubDate>Fri, 13 Nov 2020 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/docomo-f02j-button-keycodes/</guid><description>&lt;p>メモ用です&lt;/p>
&lt;h2 id="環境">環境&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">データ&lt;/th>
&lt;th style="text-align:left">値&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">メーカー&lt;/td>
&lt;td style="text-align:left">Fujitsu (docomo)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">機種&lt;/td>
&lt;td style="text-align:left">F-02J&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Androidバージョン&lt;/td>
&lt;td style="text-align:left">5.1.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ビルド番号&lt;/td>
&lt;td style="text-align:left">V28R066A&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="調べ方">調べ方&lt;/h2>
&lt;p>Android API の&lt;code>onKeyDown&lt;/code>メソッド引数&lt;code>keyCode&lt;/code>を参照&lt;/p>
&lt;h1 id="実測値">実測値&lt;/h1>
&lt;h2 id="ダイヤルパッド">ダイヤルパッド&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">1&lt;/td>
&lt;td style="text-align:left">8&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">2&lt;/td>
&lt;td style="text-align:left">9&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">3&lt;/td>
&lt;td style="text-align:left">10&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">4&lt;/td>
&lt;td style="text-align:left">11&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">5&lt;/td>
&lt;td style="text-align:left">12&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">6&lt;/td>
&lt;td style="text-align:left">13&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">7&lt;/td>
&lt;td style="text-align:left">14&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">8&lt;/td>
&lt;td style="text-align:left">15&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">9&lt;/td>
&lt;td style="text-align:left">16&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">*&lt;/td>
&lt;td style="text-align:left">17&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">0&lt;/td>
&lt;td style="text-align:left">7&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">#&lt;/td>
&lt;td style="text-align:left">18&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="ワンタッチダイアル">ワンタッチダイアル&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">１&lt;/td>
&lt;td style="text-align:left">96&lt;/td>
&lt;td style="text-align:left">外部アプリケーションのポインタ切り替えにも利用（無効化不可）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">２&lt;/td>
&lt;td style="text-align:left">97&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">３&lt;/td>
&lt;td style="text-align:left">98&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="方向サブメニューキー">方向・サブメニューキー&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">↑&lt;/td>
&lt;td style="text-align:left">19&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">↓&lt;/td>
&lt;td style="text-align:left">20&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">←&lt;/td>
&lt;td style="text-align:left">21&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">→&lt;/td>
&lt;td style="text-align:left">22&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">決定&lt;/td>
&lt;td style="text-align:left">23&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">メニュー&lt;/td>
&lt;td style="text-align:left">131&lt;/td>
&lt;td style="text-align:left">Androidの機能に割り当てられている可能性あり（詳細不明）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">電話帳&lt;/td>
&lt;td style="text-align:left">132&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="発信戻る">発信・戻る&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">発信&lt;/td>
&lt;td style="text-align:left">5&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">戻る&lt;/td>
&lt;td style="text-align:left">4&lt;/td>
&lt;td style="text-align:left">AndroidのBackボタンに割り当て&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">切断&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">不明（アプリケーションの終了になっているため）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="本体下部ファンクションボタン">本体下部ファンクションボタン&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">使い方&lt;/td>
&lt;td style="text-align:left">104&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">らくらくサイト&lt;/td>
&lt;td style="text-align:left">105&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">カメラ&lt;/td>
&lt;td style="text-align:left">103&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="サイドボタン">サイドボタン&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">読み上げ&lt;/td>
&lt;td style="text-align:left">102&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">+&lt;/td>
&lt;td style="text-align:left">24&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">25&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="ワンタッチブザー">ワンタッチブザー&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">ワンタッチブザー&lt;/td>
&lt;td style="text-align:left">83&lt;/td>
&lt;td style="text-align:left">（引き抜き時のみ。引き抜き状態では画面が隠される）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Raspberry Pi上でUbuntu server 20.04を動かしてsshできるようにするまで</title><link>https://blog.mkarakiapps.com/p/20201010-ubuntuserver-on-rpi/</link><pubDate>Sat, 10 Oct 2020 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20201010-ubuntuserver-on-rpi/</guid><description>&lt;h1 id="経緯">経緯&lt;/h1>
&lt;p>Raspbian環境が壊れたので新しく環境を用意しようとしたところ、私の大好きなUbuntuが使えることを知りました。しかし、インストールからsshできるまでかなりの時間を割かなければならなかったので、ここにメモがてら書き留めることにしました。&lt;/p>
&lt;h1 id="イメージ焼き">イメージ焼き&lt;/h1>
&lt;p>特に難しいことはないです。&lt;a class="link" href="https://ubuntu.com/download/raspberry-pi" target="_blank" rel="noopener"
>Install Ubuntu Server on a Raspberry Pi 2, 3 or 4 | Ubuntu&lt;/a> から使いたいRaspberry Pi向けのイメージをダウンロードしてください。
その際、zipではなくxzで圧縮されていますので、Windowsユーザーの方は7zipなどを使ってください。&lt;/p>
&lt;h1 id="起動">起動&lt;/h1>
&lt;p>初期パスワードだけ注意してください。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ユーザー名&lt;/th>
&lt;th>パスワード&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ubuntu&lt;/td>
&lt;td>ubuntu&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>その際、パスワードの変更を求められます。もう一度初期パスワードの入力をしなければならないのでご注意ください。&lt;/p>
&lt;h1 id="openssh-serverの設定">openssh-serverの設定&lt;/h1>
&lt;p>openssh-serverはインストールされていますが、hostkeyが設定されていません。
次のコマンドを使ってhostkeyを自動生成させてください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo dpkg-reconfigure openssh-server
&lt;/code>&lt;/pre>&lt;/div>&lt;p>生成出来たらopenssh-serverを再起動してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo service ssh restart
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="参考">参考&lt;/h1>
&lt;ul>
&lt;li>Ubuntu 20.04 LTS Server を Raspberry Pi 4 にインストール - Qiita, &lt;a class="link" href="https://qiita.com/azumabashi/items/182f365cf7405156788c" target="_blank" rel="noopener"
>https://qiita.com/azumabashi/items/182f365cf7405156788c&lt;/a> 2020.10.10 参照.&lt;/li>
&lt;li>How To: Ubuntu / Debian Linux Regenerate OpenSSH Host Keys - nixCraft, &lt;a class="link" href="https://www.cyberciti.biz/faq/howto-regenerate-openssh-host-keys/" target="_blank" rel="noopener"
>https://www.cyberciti.biz/faq/howto-regenerate-openssh-host-keys/&lt;/a> 2020.10.10 参照.&lt;/li>
&lt;/ul></description></item><item><title>PowerShellを使ってMinecraftのリソースを正式名でエクスポートする</title><link>https://blog.mkarakiapps.com/p/20200807-minecraft-export-resname-with-powershell/</link><pubDate>Thu, 06 Aug 2020 15:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20200807-minecraft-export-resname-with-powershell/</guid><description>&lt;h1 id="最初に">最初に&lt;/h1>
&lt;p>Minecraftはデフォルトリソースをハッシュ名にして保存しています。実際のリソース名とはJSONファイルを使用して関連付けています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;objects&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;resource1.png&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;hash&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1234&lt;/span>&lt;span class="p">},&lt;/span>
&lt;span class="nt">&amp;#34;resource2.png&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;hash&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5678&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>このような形でハッシュとリソース名を対応付けています。これをリソース名にしてエクスポートしようという試みです。&lt;/p>
&lt;h1 id="対応環境">対応環境&lt;/h1>
&lt;p>Minecraft 1.16とPowerShell 5.1で実行できることを確認しました。また、オープンソース版のPowerShellでも実行できると思われます。&lt;/p>
&lt;p>&lt;strong>最低限の検証しかしていません。&lt;/strong>&lt;/p>
&lt;h1 id="実際のコード">実際のコード&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="nv">$objects_dir&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;C:\Users\Owner\AppData\Roaming\.minecraft\assets\objects&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c"># .minecraftフォルダ内のassets/objectsまでのフルパス&lt;/span>
&lt;span class="nv">$listjson&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;C:\Users\Owner\AppData\Roaming\.minecraft\assets\indexes\1.16.json&amp;#34;&lt;/span> &lt;span class="c"># .minecraftフォルダ内のassets/indexes内の任意のバージョン名のJSONファイルまでのフルパス&lt;/span>
&lt;span class="nv">$exportdir&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;C:\Users\Owner\AppData\Roaming\.minecraft\assets\extracted&amp;#34;&lt;/span> &lt;span class="c"># エクスポート先フォルダのフルパス&lt;/span>
&lt;span class="c"># ===================&lt;/span>
&lt;span class="nv">$json&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">Get-Content&lt;/span> &lt;span class="nv">$listjson&lt;/span>
&lt;span class="nv">$list&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">ConvertFrom-Json&lt;/span> &lt;span class="n">-InputObject&lt;/span> &lt;span class="nv">$json&lt;/span>
&lt;span class="k">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$r&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">$list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">objects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">psobject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Properties&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nv">$fname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Name&lt;/span>
&lt;span class="nv">$afname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">objects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nv">$fname&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">hash&lt;/span>
&lt;span class="nv">$hash_dirname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$afname&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nv">$from&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$objects_dir&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;\&amp;#39;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="nv">$hash_dirname&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;\&amp;#39;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="nv">$afname&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nv">$to&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$exportdir&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;\&amp;#39;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="nv">$fname&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nv">$destdir&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">Split-Path&lt;/span> &lt;span class="nv">$to&lt;/span> &lt;span class="n">-Parent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(!(&lt;/span>&lt;span class="nb">Test-Path&lt;/span> &lt;span class="n">-Path&lt;/span> &lt;span class="nv">$destdir&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nv">$0_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">New-Item&lt;/span> &lt;span class="nv">$destdir&lt;/span> &lt;span class="n">-Type&lt;/span> &lt;span class="n">Directory&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nb">Copy-Item&lt;/span> &lt;span class="n">-Path&lt;/span> &lt;span class="nv">$from&lt;/span> &lt;span class="n">-Destination&lt;/span> &lt;span class="nv">$to&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>汚いコードですが概ねこのような形です。先頭の３行(改行含め４行)を書き換えて利用してください。&lt;/p>
&lt;h1 id="注意点解説">注意点・解説&lt;/h1>
&lt;p>　先ほども説明した通り、JSONでリストが作られています。そのため、&lt;code>ConvertFrom-Json&lt;/code>で簡単に読み込むことができました。しかし、いくつか注意点があります。&lt;/p>
&lt;h2 id="powershell-51ではjsonをhashtableにできない">PowerShell 5.1ではJSONをHashtableにできない&lt;/h2>
&lt;p>　Windows 10に標準搭載されているPowerShellは&lt;code>-AsHashtable&lt;/code>オプションに対応していません。そのため、&lt;code>PSCustomObject&lt;/code>で出力されたオブジェクト名をそのまま取得することができません。
　これを解決するために、foreach文では&lt;code>psobject.Properties&lt;/code>を取得したいオブジェクトにつけることによって、プロパティのデータをforeachにかけています。
　これによって取得したオブジェクト名をそのまま埋め込み、&lt;code>$list.objects.$fname.hash&lt;/code>とすることによってPSCustomObjectのままでデータを取得しています。&lt;/p>
&lt;h2 id="ファイルコピー時に親ディレクトリがない">ファイルコピー時に親ディレクトリがない&lt;/h2>
&lt;p>　PowerShellの&lt;code>Copy-Item&lt;/code>コマンドレットは親ディレクトリを自動的に作ることはできません。そのため、&lt;code>Split-Path $to -Parent&lt;/code>で親ディレクトリを取得し、当該ディレクトリがなかった場合は、新しくディレクトリを作成しています。&lt;/p>
&lt;h2 id="ディレクトリ作成時のログ">ディレクトリ作成時のログ&lt;/h2>
&lt;p>&lt;code>New-Item&lt;/code>コマンドレットを使用すると、実行時に結果としてディレクトリの詳細データを出力します。しかし、今回は邪魔なだけなので、&lt;code>$0_&lt;/code>変数に結果を代入させることによって表示をなくしています。&lt;/p></description></item></channel></rss>