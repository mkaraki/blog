<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mkarakiのブログ</title><link>https://blog.mkarakiapps.com/</link><description>Recent content on mkarakiのブログ</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><lastBuildDate>Sun, 01 Aug 2021 03:00:00 +0000</lastBuildDate><atom:link href="https://blog.mkarakiapps.com/index.xml" rel="self" type="application/rss+xml"/><item><title>ご自宅統合認証システムを作った話</title><link>https://blog.mkarakiapps.com/p/20210801-homemaid-federated-auth/</link><pubDate>Sun, 01 Aug 2021 03:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20210801-homemaid-federated-auth/</guid><description>&lt;p>この記事では自宅でLDAP, RADIUS, SAML IdPからなるかんたんな認証システムを作った話をします。
また、おまけとしてRADIUSでインターネット利用状況の取得をした話も書きます。&lt;/p>
&lt;p>今回もメモ要素が強いです。
間違いなどは報告いただけると助かります。&lt;/p>
&lt;h2 id="環境">環境&lt;/h2>
&lt;ul>
&lt;li>Ubuntu 20.04&lt;/li>
&lt;li>hoge.example.com をホスト名に設定&lt;/li>
&lt;li>example.com をドメインとして利用&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>注意:&lt;/strong> この記事ではSuffixなどの書き換え指示を書きません。ご自身で読み替えてください。&lt;/p>
&lt;h2 id="ホスト名の設定">ホスト名の設定&lt;/h2>
&lt;p>この手順はスキップすることも出来ますが、統合認証システムのみを動かすホストであれば設定しておいて損はないと思います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo hostnamectl set-hostname hoge.example.com
&lt;/code>&lt;/pre>&lt;/div>&lt;p>また、&lt;code>/etc/hosts&lt;/code>にある旧ホスト名も設定し直してください。&lt;/p>
&lt;h2 id="slapd-ldap-utilsのインストール">slapd, ldap-utilsのインストール&lt;/h2>
&lt;p>必要に応じて&lt;code>sudo apt update&lt;/code>を行ってください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo apt -y install slapd ldap-utils
&lt;/code>&lt;/pre>&lt;/div>&lt;p>途中で管理者パスワードを設定するように言われるので、思うがままにパスワードを設定してください。&lt;/p>
&lt;blockquote>
&lt;p>管理者アカウントは初期状態で &lt;code>cn=admin,dc=example,dc=com&lt;/code> となります。&lt;br>
ドメイン名を読み替え、メモをしておくことを推奨します&lt;/p>
&lt;/blockquote>
&lt;h3 id="ホスト名の設定をスキップした場合">ホスト名の設定をスキップした場合。&lt;/h3>
&lt;p>ホスト名の設定を行わなかった場合、下記のコマンドを使うことにより手動でドメインの設定を行うことが出来ます。&lt;/p>
&lt;pre>&lt;code>sudo dpkg-reconfigure slapd
&lt;/code>&lt;/pre>&lt;p>設定値は下記の通りです&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">Name&lt;/th>
&lt;th style="text-align:left">Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">Omit OpenLDAP &amp;hellip;&lt;/td>
&lt;td style="text-align:left">No&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">DNS domain name&lt;/td>
&lt;td style="text-align:left">ホスト名のドメイン部（hoge.example.com =&amp;gt; example.com）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Organization name&lt;/td>
&lt;td style="text-align:left">上と同じ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Administrator Password&lt;/td>
&lt;td style="text-align:left">管理者パスワード&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>以降の設定はデフォルト値を利用してください。&lt;/p>
&lt;h2 id="ldapにユーザグループ用のouを追加">LDAPにユーザ・グループ用のOUを追加&lt;/h2>
&lt;p>&lt;code>base.ldif&lt;/code>ファイルを作り、下記の内容を書き込んでください。&lt;/p>
&lt;pre>&lt;code class="language-ldif" data-lang="ldif">dn: ou=people,dc=example,dc=com
objectClass: organizationalUnit
ou: people
dn: ou=groups,dc=example,dc=com
objectClass: organizationalUnit
ou: groups
&lt;/code>&lt;/pre>&lt;pre>&lt;code># ldapadd -x -D cn=admin,dc=example,dc=com -W -f base.ldif
Enter LDAP Password: &amp;lt;管理者パスワードを入力&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="ldap-account-managerのインストール">LDAP Account Managerのインストール&lt;/h2>
&lt;p>まず、Apache2とPHPをインストールします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo apt -y install apache2 php php-cgi libapache2-mod-php php-mbstring php-common php-pear
&lt;/code>&lt;/pre>&lt;/div>&lt;p>PHPを有効化します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo a2enconf php7.4-cgi
$ sudo systemctl reload apache2
&lt;/code>&lt;/pre>&lt;/div>&lt;p>LDAP Account Managerをインストールします。&lt;/p>
&lt;pre>&lt;code>$ sudo apt -y install ldap-account-manager
&lt;/code>&lt;/pre>&lt;p>&lt;strong>注意:&lt;/strong> インストール時はすべてのホストからの通信を受けるようになっています。
&lt;code>/etc/apache2/conf-enabled/ldap-account-manager.conf&lt;/code>を編集し、アクセス可能ホストを絞ることを強く推奨します。&lt;/p>
&lt;p>関連の設定が終わったらApache2を再起動します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo systemctl restart apache2
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ldap-account-managerの初期設定">LDAP Account Managerの初期設定&lt;/h2>
&lt;p>画像無しでは解説がとても難しいので別の解説サイトを提示します。&lt;/p>
&lt;p>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=8" target="_blank" rel="noopener"
>Ubuntu 20.04 LTS : OpenLDAP : LDAP Account Manager 設定 : Server World&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.server-world.info" target="_blank" rel="noopener"
>Server World&lt;/a> はOS毎に様々なサービスの設定方法を提示しているサイトです。
日本語でわかりやすく書いてありますので、なにか作りたいものがある場合は一度ここを参照してみることをおすすめします。&lt;/p>
&lt;h3 id="wpa2-enterpriseなどのms-chap認証を行いたい場合">WPA2 EnterpriseなどのMS-CHAP認証を行いたい場合&lt;/h3>
&lt;p>&lt;strong>本来設定すべきではありませんが&lt;/strong>、MS-CHAP認証を利用したい場合はパスワードを平文で保管する必要があります。&lt;/p>
&lt;p>&lt;code>Server Settings &amp;gt; Module settings &amp;gt; Unix &amp;gt; Options &amp;gt; Password hash type&lt;/code>
を&lt;code>PLAIN&lt;/code>に設定してください。&lt;/p>
&lt;h2 id="freeradiusのインストール">FreeRADIUSのインストール&lt;/h2>
&lt;p>ここではLDAPと連携したRADIUSに必要なパッケージをインストールします。
利用状況や課金管理は別の項で解説します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo apt -y install freeradius freeradius-ldap freeradius-utils
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="freeradiusとldapの連携設定">FreeRADIUSとLDAPの連携設定&lt;/h2>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;p>まず、&lt;code>users&lt;/code>を編集し、LDAP認証に対応させます。
下のコードを追記してください。
また、それ以外のコードはコメントアウトしても構いません。&lt;/p>
&lt;pre>&lt;code>DEFAULT Auth-Type = LDAP
Fall-Through = 1
&lt;/code>&lt;/pre>&lt;p>次にldapのmodを有効化します。&lt;/p>
&lt;pre>&lt;code>$ sudo ln -s /etc/freeradius/3.0/mods-available/ldap /etc/freeradius/3.0/mods-enabled/ldap
&lt;/code>&lt;/pre>&lt;p>&lt;code>mods-enabled/ldap&lt;/code>を編集し、LDAP接続先を設定します。&lt;/p>
&lt;ul>
&lt;li>19行目あたり &lt;code>server = ''&lt;/code>でサーバを設定します&lt;/li>
&lt;li>28行目あたり &lt;code>identity = ''&lt;/code>に管理者アカウントを設定します&lt;/li>
&lt;li>29行目あたり &lt;code>password = ''&lt;/code>に管理者パスワードを設定します&lt;/li>
&lt;li>33行目あたり &lt;code>base_dn = ''&lt;/code>に検索対象のDNを設定します。
この記事通りの設定の場合、&lt;code>ou=people,dc=example,dc=com&lt;/code>となります。&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sites-enabled/default&lt;/code>と&lt;code>sites-enabled/inner-tunnel&lt;/code>を編集し、ldapを有効にします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>authorize&lt;/code>セクション内の&lt;code>ldap&lt;/code>のコメントアウトを外します&lt;/li>
&lt;li>&lt;code>authenticate&lt;/code>セクション内の&lt;code>Auth-Type LDAP&lt;/code>セクションのコメントアウトをすべて外します&lt;/li>
&lt;li>&amp;lsquo;post-auth&amp;rsquo;セクションの&lt;code>ldap&lt;/code>のコメントアウトを外します&lt;/li>
&lt;/ul>
&lt;p>以上で連携設定は完了です。
必要に応じてClientを設定してください。
すべての設定が終わったらFreeRADIUSを再起動して設定を読み込ませてください。&lt;/p>
&lt;h2 id="freeradiusでeap-peapms-chapv2を設定する">FreeRADIUSでEAP-PEAP/MS-CHAPv2を設定する&lt;/h2>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;h3 id="eap用の証明書を生成">EAP用の証明書を生成&lt;/h3>
&lt;p>私は&lt;a class="link" href="https://letsencrypt.org/" target="_blank" rel="noopener"
>Let&amp;rsquo;s Encrypt&lt;/a>を利用しました。
注意点として、証明書ファイルの所有者を&lt;code>freerad:freerad&lt;/code>に設定しておかないとFreeRADIUSから読み込めなくなります。&lt;/p>
&lt;h3 id="freeradiusの設定">FreeRADIUSの設定&lt;/h3>
&lt;p>&lt;code>mods-enabled/eap&lt;/code>を編集します。&lt;/p>
&lt;ul>
&lt;li>&lt;code>eap&lt;/code>セクション&lt;code>default_eap_type&lt;/code>を&lt;code>peap&lt;/code>に設定&lt;/li>
&lt;li>&lt;code>eap&lt;/code>セクション内&lt;code>tls-config til-common&lt;/code>セクションの下記の項目を変更してください。
&lt;ul>
&lt;li>&lt;code>private_key_password&lt;/code> 秘密鍵のパスワードを指定します。Let&amp;rsquo;s encryptの場合は無視して大丈夫です。&lt;/li>
&lt;li>&lt;code>private_key_file&lt;/code> 秘密鍵のファイルを指定してください。Let&amp;rsquo;s encryptでは&lt;code>privkey.pem&lt;/code>が該当します。&lt;/li>
&lt;li>&lt;code>certificate_file&lt;/code> 証明書ファイルを指定してください。 Let&amp;rsquo;s encryptでは&lt;code>fullchain.pem&lt;/code>が該当します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="注意事項">注意事項&lt;/h3>
&lt;p>MS-CHAPv2で認証をする際は、LDAP側に平文でパスワードが保管されている必要があります。
パスワードの取り扱いには十分注意してください。&lt;/p>
&lt;h2 id="freeradius側でrealmに応じてvlanを切り替える">FreeRADIUS側でRealmに応じてVlanを切り替える&lt;/h2>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;p>&lt;code>proxy.conf&lt;/code>にRealmを設定します。
設定値にstripを付けることで、LDAP側に問い合わせるユーザ名からRealm部を削除します。&lt;/p>
&lt;pre>&lt;code>realm hoge.fuga {
strip
}
&lt;/code>&lt;/pre>&lt;p>&lt;code>users&lt;/code>に付与したいVLANを記述します。同じ方法でその他のAttributeも付与できます。&lt;/p>
&lt;pre>&lt;code class="language-conf" data-lang="conf"># Realmが一致している場合にVLANを割り振る
DEFAULT Realm == &amp;quot;hoge.fuga&amp;quot;
Tunnel-Type = 13,
Tunnel-Medium-Type = 6,
Tunnel-Private-Group-Id = 100
# ユーザ名とRealmが一致している場合にVLANを割り振る
DEFAULT User-Name == &amp;quot;user@hoge.fuga&amp;quot;
Tunnel-Type = 13,
Tunnel-Medium-Type = 6,
Tunnel-Private-Group-Id = 100
&lt;/code>&lt;/pre>&lt;h3 id="課金システムで表示されるユーザ名を一致させたい">課金システムで表示されるユーザ名を一致させたい&lt;/h3>
&lt;pre>&lt;code class="language-conf" data-lang="conf"> User-Name = &amp;quot;user&amp;quot;,
&lt;/code>&lt;/pre>&lt;p>を&lt;code>DEFAULT&lt;/code>行の下に挿入してください。&lt;/p>
&lt;h2 id="radiusで課金管理-accounting-を行う">RADIUSで課金管理 (Accounting) を行う&lt;/h2>
&lt;h3 id="mysqlを設定する">MySQLを設定する&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo apt -y install mysql-server
&lt;/code>&lt;/pre>&lt;/div>&lt;p>必要に応じて&lt;code>sudo mysql_secure_installation&lt;/code>を使い設定を行ってください。
今回は完全に閉鎖された空間で利用することを前提にこの設定を行いません。&lt;/p>
&lt;p>もし、rootパスワードを設定した場合、記事内の&lt;code>mysql -u root&lt;/code>を&lt;code>mysql -u root -p&lt;/code>に読み替えてください。&lt;/p>
&lt;p>&lt;code>sudo mysql -u root&lt;/code>でMySQLに入り以下のSQLを投入してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DATABASE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="k">GRANT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">localhost&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IDENTIFIED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;radius&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="n">FLUSH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIVILEGES&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="n">QUIT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>注意:&lt;/strong> 今回のインストール例ではRADIUS用アカウントのパスワードを&lt;code>radius&lt;/code>に設定しています。
これは非常に脆弱なパスワードであり、強固なパスワードに設定し直すことを強く推奨します。&lt;/p>
&lt;p>Root権限で下記のコマンドを実行します。&lt;/p>
&lt;pre>&lt;code># mysql -u root radius &amp;lt; /etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql
&lt;/code>&lt;/pre>&lt;p>下記の内容でsqlファイルを作成し、上記の方法でradiusデータベースに適応させてください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radacct&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radacct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radacctid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">auto_increment&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessionid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctuniqueid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">groupname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">realm&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasportid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasporttype&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctupdatetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctinterval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessiontime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unsigned&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctauthentic&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connectinfo_start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connectinfo_stop&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctinputoctets&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctoutputoctets&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">bigint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">calledstationid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">callingstationid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctterminatecause&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">servicetype&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedprotocol&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6address&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedinterfaceid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">44&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegatedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">class&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">varchar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">radacctid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UNIQUE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctuniqueid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctuniqueid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedipaddress&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6address&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedipv6address&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedipv6prefix&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">framedinterfaceid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">framedinterfaceid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegatedipv6prefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegatedipv6prefix&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessionid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctsessionid&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctsessiontime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctsessiontime&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctinterval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctinterval&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bulk_close&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">acctstoptime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nasipaddress&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">acctstarttime&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ENGINE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">INNODB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>情報:&lt;/strong> 私がインストールを試みた際は、&lt;code>/etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql&lt;/code>に不具合があり、&lt;a class="link" href="https://github.com/FreeRADIUS/freeradius-server/blob/master/raddb/mods-config/sql/main/mysql/schema.sql" target="_blank" rel="noopener"
>GitHubに存在する正しいスキーマ&lt;/a>を適用し、間違っているテーブルを削除しました。&lt;br>
この不具合は一時的なものであると考えられるため、記事の閲覧時にこの手順が必要ない可能性が高いです。
また、今回修正したのは最低限課金情報取得に必要なテーブルであり、その他のテーブルにも不具合がある可能性があります。&lt;br>
不具合があった場合はFreeRADIUSを終了させ、&lt;code>sudo freeradius -X&lt;/code>を実行し、エラーを確認してください。&lt;/p>
&lt;h3 id="freeradiusをmysqlに対応させる">FreeRADIUSをMySQLに対応させる&lt;/h3>
&lt;p>この項ではファイル名先頭の&lt;code>/etc/freeradius/3.0/&lt;/code>を省略して記述します。&lt;/p>
&lt;p>sql関係のパッケージをインストールします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo apt -y install freeradius-mysql
&lt;/code>&lt;/pre>&lt;/div>&lt;p>次に、sqlのmodを有効化します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo ln -s /etc/freeradius/3.0/mods-available/sql /etc/freeradius/3.0/mods-enabled/
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>mods-enabled/sql&lt;/code>を編集し、SQL接続情報を記述します。&lt;/p>
&lt;ul>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>dialect&lt;/code>を&lt;code>mysql&lt;/code>に設定&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>driver&lt;/code>を&lt;code>rlm_sql_${dialect}&lt;/code>に設定&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクジョン下の&lt;code>mysql&lt;/code>セクションに存在する&lt;code>tls&lt;/code>セクション全体をコメントアウト&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>server&lt;/code>, &lt;code>port&lt;/code>を必要に応じて変更&lt;/li>
&lt;li>&lt;code>sql&lt;/code>セクションの&lt;code>login&lt;/code>, &lt;code>password&lt;/code>を前の項で設定したユーザ名、パスワードに設定&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sites-enabled/default&lt;/code>を編集し、課金情報をMySQLに保管する設定にします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>accounting&lt;/code>セクション内の&lt;code>sql&lt;/code>をコメントアウトします&lt;/li>
&lt;/ul>
&lt;h3 id="daloradiusをインストールする">daloRADIUSをインストールする&lt;/h3>
&lt;p>今回daloRADIUSは課金情報確認の為だけにインストールします。&lt;/p>
&lt;p>前提パッケージをインストールします。&lt;/p>
&lt;pre>&lt;code>$ sudo apt -y install php libapache2-mod-php php-{gd,common,mail,mail-mime,mysql,pear,db,mbstring,xml,curl} unzip
&lt;/code>&lt;/pre>&lt;p>daloRADIUSをダウンロードし、&lt;code>/var/www/html&lt;/code>に展開します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ wget https://github.com/lirantal/daloradius/archive/master.zip
$ unzip master.zip
$ sudo mv daloradius-master /var/www/html/daloradius
&lt;/code>&lt;/pre>&lt;/div>&lt;p>MySQLに必要なテーブルを挿入します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo mysql -u root radius &amp;lt; /var/www/html/daloradius/contrib/db/fr2-mysql-daloradius-and-freeradius.sql
$ sudo mysql -u root radius &amp;lt; /var/www/html/daloradius/contrib/db/mysql-daloradius.sql
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>/var/www/html/daloradius/library/daloradius.conf.php&lt;/code>を編集し、MySQLへのアクセス情報を設定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_HOST&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># MySQLのホストを設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_PORT&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;3306&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># MySQLのポートを設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_USER&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;radius&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># ユーザ名を設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_PASS&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;radius&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># パスワードを設定
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nv">$configValues&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CONFIG_DB_NAME&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;radius&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># データベース名を設定
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これでdaloRADIUSのインストールは終了です。
初期パスワードは&lt;code>radius&lt;/code>です。&lt;/p>
&lt;h2 id="openldapでレプリケーションを設定する">OpenLDAPでレプリケーションを設定する。&lt;/h2>
&lt;h3 id="プロバイダーサーバ-マスターの設定">プロバイダーサーバ (マスター)の設定&lt;/h3>
&lt;p>&lt;code>sync.ldif&lt;/code>のようなファイルを作り、下記の内容を記述します。&lt;/p>
&lt;pre>&lt;code class="language-ldif" data-lang="ldif">dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulePath: /usr/lib/ldap
olcModuleLoad: syncprov.la
dn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
olcSpSessionLog: 100
&lt;/code>&lt;/pre>&lt;p>下記のコマンドで適用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo ldapadd -Y EXTERNAL -H ldapi:/// -f sync.ldif
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="コンシューマーサーバ-スレーブの設定">コンシューマーサーバ (スレーブ)の設定&lt;/h3>
&lt;p>&lt;a class="link" href="#%e3%83%9b%e3%82%b9%e3%83%88%e5%90%8d%e3%81%ae%e8%a8%ad%e5%ae%9a" >ホスト名の設定&lt;/a>と&lt;a class="link" href="#slapd,-ldap-utils%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab" >slapd, ldap-utilsのインストール&lt;/a>まで行ってください。&lt;/p>
&lt;p>&lt;code>sync.ldif&lt;/code>のようなファイルを作り、下記の内容を記述してください。（項目はそれぞれ読み替えてください）&lt;/p>
&lt;pre>&lt;code class="language-ldif" data-lang="ldif">dn: olcDatabase={1}mdb,cn=config
changetype: modify
add: olcSyncRepl
olcSyncRepl: rid=001
provider=ldap://hoge.example.com:389/
bindmethod=simple
binddn=&amp;quot;cn=admin,dc=example,dc=com&amp;quot;
credentials=adminpassword
searchbase=&amp;quot;dc=example,dc=com&amp;quot;
scope=sub
schemachecking=on
type=refreshAndPersist
retry=&amp;quot;30 5 300 3&amp;quot;
interval=00:00:01:00
&lt;/code>&lt;/pre>&lt;p>&lt;code>olcSyncRepl&lt;/code>の詳細&lt;/p>
&lt;ul>
&lt;li>&lt;code>provider&lt;/code> 同期先LDAP&lt;/li>
&lt;li>&lt;code>binddn&lt;/code> 管理者ユーザ名&lt;/li>
&lt;li>&lt;code>credentials&lt;/code> 管理者パスワード&lt;/li>
&lt;li>&lt;code>searchbase&lt;/code> 同期するDN (ドメイン名が良いと思われる)&lt;/li>
&lt;li>&lt;code>retry&lt;/code> 失敗時のリトライ動作 (&lt;code>[&amp;lt;retry interval&amp;gt; &amp;lt;# of retries&amp;gt;]+&lt;/code>)&lt;/li>
&lt;li>&lt;code>interval&lt;/code> 同期間隔 (&lt;code>dd:hh:mm:ss&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>詳細は&lt;a class="link" href="https://www.openldap.org/doc/admin25/slapdconfig.html#syncrepl" target="_blank" rel="noopener"
>LDAP Administrator&amp;rsquo;s Guide&lt;/a>を参照&lt;/p>
&lt;p>下記のコマンドで適用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo ldapadd -Y EXTERNAL -H ldapi:/// -f sync.ldif
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://computingforgeeks.com/install-and-configure-openldap-server-ubuntu/" target="_blank" rel="noopener"
>https://computingforgeeks.com/install-and-configure-openldap-server-ubuntu/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://qiita.com/cffnpwr/items/be903005e291d0ece514" target="_blank" rel="noopener"
>https://qiita.com/cffnpwr/items/be903005e291d0ece514&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=1" target="_blank" rel="noopener"
>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=openldap&amp;f=1&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=8" target="_blank" rel="noopener"
>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=openldap&amp;f=8&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://computingforgeeks.com/how-to-install-freeradius-and-daloradius-on-ubuntu/" target="_blank" rel="noopener"
>https://computingforgeeks.com/how-to-install-freeradius-and-daloradius-on-ubuntu/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://qiita.com/bashaway/items/c96a2b14c46acd8cdc40" target="_blank" rel="noopener"
>https://qiita.com/bashaway/items/c96a2b14c46acd8cdc40&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.casleyconsulting.co.jp/blog/engineer/230/" target="_blank" rel="noopener"
>https://www.casleyconsulting.co.jp/blog/engineer/230/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://mx.eduroam.jp/docs/conf-freeradius.html" target="_blank" rel="noopener"
>http://mx.eduroam.jp/docs/conf-freeradius.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://networklab.sub.jp/lab/network/wifi/201502/476/" target="_blank" rel="noopener"
>http://networklab.sub.jp/lab/network/wifi/201502/476/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.nii.ac.jp/openforum/upload/20190529PM_Auth_03_Suenaga.pdf" target="_blank" rel="noopener"
>https://www.nii.ac.jp/openforum/upload/20190529PM_Auth_03_Suenaga.pdf&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://techexpert.tips/ja/freeradius-ja/ubuntu-linux%E3%81%A7%E3%81%AEmysql%E7%B5%B1%E5%90%88%E3%81%A8freeradius%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" target="_blank" rel="noopener"
>https://techexpert.tips/ja/freeradius-ja/ubuntu-linux%E3%81%A7%E3%81%AEmysql%E7%B5%B1%E5%90%88%E3%81%A8freeradius%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/FreeRADIUS/freeradius-server/blob/master/raddb/mods-config/sql/main/mysql/schema.sql" target="_blank" rel="noopener"
>https://github.com/FreeRADIUS/freeradius-server/blob/master/raddb/mods-config/sql/main/mysql/schema.sql&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.server-world.info/query?os=Ubuntu_20.04&amp;amp;p=openldap&amp;amp;f=6" target="_blank" rel="noopener"
>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=openldap&amp;f=6&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.openldap.org/doc/admin25/slapdconfig.html#syncrepl" target="_blank" rel="noopener"
>https://www.openldap.org/doc/admin25/slapdconfig.html#syncrepl&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>無料で使えるインターネット関連サービス一覧</title><link>https://blog.mkarakiapps.com/p/20210720-free-inet-services/</link><pubDate>Mon, 19 Jul 2021 15:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20210720-free-inet-services/</guid><description>&lt;p>この記事は別のサイトと連携している記事です。&lt;/p>
&lt;p>常に金欠な私が見つけた無料でいい感じのサービスをメモがてら書いていきます。&lt;/p>
&lt;h2 id="認証系">認証系&lt;/h2>
&lt;h3 id="jumpcloudhttpsjumpcloudcom">&lt;a class="link" href="https://jumpcloud.com/" target="_blank" rel="noopener"
>JumpCloud&lt;/a>&lt;/h3>
&lt;p>　認証系サービスとしてかなり優秀で、10ユーザまでLDAPやRADIUSが使え、独自の認証連携ソフトウェア上で10デバイスまで無料でほぼフル機能がついています。おまけに最初の10日間は24時間365日チャットサポートが有るという素晴らしい待遇。&lt;/p>
&lt;p>　サポートを実際に私も受けましたが、画面共有をしながら状況の確認を行っていただき、かなり親切で丁寧な印象を受けました。また、どうやら10日を超えてもフォームでサポートを受けれる気がします。（未確認）&lt;/p>
&lt;p>　ご自宅 WPA2 EnterpriseやZabbix LDAPなどをやってみたい方は一度試してみてもいいと思います。&lt;/p>
&lt;h3 id="azure-active-directoryhttpsazuremicrosoftcomja-jpservicesactive-directory">&lt;a class="link" href="https://azure.microsoft.com/ja-jp/services/active-directory/" target="_blank" rel="noopener"
>Azure Active Directory&lt;/a>&lt;/h3>
&lt;p>　こちらはSSOとActive Directoryにおいてかなり優秀なシステムです。ローカルのActive Directoryと連携できるAzure AD Connectも無料で使える上、Windows 10 Proなどで使えるAzure ADログインに対応しています（当たり前の話ですが）。いつの間にかSSOも無制限になっており、ユーザもある程度入れられたと記憶しています（具体的な数を調べられなかった）&lt;/p>
&lt;p>　JumpCloudと連携することでJumpCloud側の制限である10ユーザまでRadiusやLDAPを利用できるようになります。&lt;/p>
&lt;h3 id="cloudflare-accesshttpswwwcloudflarecomja-jpteamsaccess">&lt;a class="link" href="https://www.cloudflare.com/ja-jp/teams/access/" target="_blank" rel="noopener"
>Cloudflare Access&lt;/a>&lt;/h3>
&lt;p>　自分がホストしているWebサービスなどにアクセスする際にメールアドレス認証やSSOをかませる事ができるサービスです。&lt;/p>
&lt;p>　例えばGrafanaのWebコンソールにアクセスできるユーザを先に紹介しているAzure ADなどで制限することが出来ます。アクセス元はCloudflareのIP扱いになるので、それだけをファイアウォールで許可することである程度安全な環境を作ることが出来ます（ただし、監視などの通信についてはよく考える必要性がありますが）&lt;/p>
&lt;h2 id="cdn">CDN&lt;/h2>
&lt;h3 id="cloudflarehttpswwwcloudflarecom">&lt;a class="link" href="https://www.cloudflare.com/" target="_blank" rel="noopener"
>Cloudflare&lt;/a>&lt;/h3>
&lt;p>　定番ですが一応紹介しておきます。CDNとして使えますし、IPv6やIPv4非対応ホストにそれぞれのIPを作ってあげる用途で使うことも一応可能です。また、SSL非対応のホストに外見だけSSLを渡すことも出来ます（Cloudflareとホスト間の通信は暗号化されないので注意）&lt;/p>
&lt;h2 id="vps">VPS&lt;/h2>
&lt;h3 id="oracle-cloud-free-tier---compute-vmhttpswwworaclecomjpcloudfree">&lt;a class="link" href="https://www.oracle.com/jp/cloud/free/" target="_blank" rel="noopener"
>Oracle Cloud Free Tier - Compute VM&lt;/a>&lt;/h3>
&lt;p>　1/8 OCPUと1GBメモリを搭載している2つのVMを使えます。私はここにVPNとZabbixを置いています。かなり快適ですし、これが無料なのは信じられないレベルです。&lt;/p>
&lt;h2 id="web-server">Web Server&lt;/h2>
&lt;h3 id="github-pageshttpspagesgithubcom">&lt;a class="link" href="https://pages.github.com/" target="_blank" rel="noopener"
>GitHub Pages&lt;/a>&lt;/h3>
&lt;p>　GitHubが提供する静的サイト限定のサービスです。標準でJekyllに対応している他、GitHub Actionsと合わせることでHugoなどのビルドも自動化出来ます。&lt;/p>
&lt;p>　SSLや独自ドメイン（サブドメイン含む）に対応していますが、ホストするコンテンツが1GB以内である、1ヶ月に100GBまで、1時間に10ビルドまでなどの制限があるそうです。（&lt;a class="link" href="https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages#usage-limits" target="_blank" rel="noopener"
>About GitHub Pages - GitHub Docs&lt;/a>）&lt;/p>
&lt;h3 id="xreahttpswwwxreacom">&lt;a class="link" href="https://www.xrea.com/" target="_blank" rel="noopener"
>XREA&lt;/a>&lt;/h3>
&lt;p>　GMOが提供するレンタルサーバです。スペックは下記の通り。&lt;/p>
&lt;ul>
&lt;li>1GB のストレージ&lt;/li>
&lt;li>マルチドメイン（10個）&lt;/li>
&lt;li>1GB/Day の転送量&lt;/li>
&lt;li>WordPress利用可能&lt;/li>
&lt;li>チャットサポート&lt;/li>
&lt;li>CGI/SSI/Perl/PHP/Ruby対応&lt;/li>
&lt;li>SSL対応（独自、Let&amp;rsquo;s encrypt）&lt;/li>
&lt;li>&lt;strong>広告が表示されます&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>　また、メインではないのでしょうが、一応100個までメールアドレスを発行できるため、メールサーバとしても使えます。一日あたり1,000通もメールをメールを送ることは無いでしょうから十分だと思っています。&lt;/p>
&lt;h3 id="starserver-freehttpswwwstarnejpfree">&lt;a class="link" href="https://www.star.ne.jp/free/" target="_blank" rel="noopener"
>StarServer Free&lt;/a>&lt;/h3>
&lt;p>　Netowlの提供するレンタルサーバです。プランは下記のとおりです。&lt;/p>
&lt;ul>
&lt;li>2GB 広告無し&lt;/li>
&lt;li>4GB&lt;/li>
&lt;li>2GB PHP, MySQL(50MB)&lt;/li>
&lt;/ul>
&lt;p>　一番上のプラン以外はスマートフォンアクセス時にのみ広告が表示されます。難点として、SSL非対応です。また、ドメインを1つ追加できると謳っていますが、TLDにかなり厳しい制限があり、それ以外を利用するには有料プランにしなければならないとのこと。&lt;/p>
&lt;p>　個人的には静的なサイトを2GBプランを使ってCloudflareを噛ませて公開するのに丁度いいと思っています。&lt;/p>
&lt;h3 id="xfreehttpswwwxfreenejp">&lt;a class="link" href="https://www.xfree.ne.jp/" target="_blank" rel="noopener"
>XFREE&lt;/a>&lt;/h3>
&lt;p>　Xserverが提供するレンタルサーバです。プランは下記の通り。&lt;/p>
&lt;ul>
&lt;li>1GB 広告無し（条件付き）&lt;/li>
&lt;li>1GB PHP, MySQL(50MB)&lt;/li>
&lt;li>2GB WordPress (DB: 100MB)&lt;/li>
&lt;/ul>
&lt;p>　一番上のプランは3ヶ月以上ファイルを変更する動作をしていない場合に広告表示、それ以外は常時のようです。独自のドメインは10個とのことですが、私が試した限りStarServer Freeと同じようにリストに無いTLDを持つドメインは追加できません。こちらもSSL非対応です。&lt;/p>
&lt;p>　使い道としてはStarServer Freeと同じ感じになると思います。&lt;/p>
&lt;h2 id="dns">DNS&lt;/h2>
&lt;h3 id="cloudflarehttpswwwcloudflarecom-1">&lt;a class="link" href="https://www.cloudflare.com/" target="_blank" rel="noopener"
>Cloudflare&lt;/a>&lt;/h3>
&lt;p>　Webが関連するところにはだいたい現れるであろうCloudflareです。DNSツールとしてかなり使いやすく、対応しているサービスをホストするのであればIPを隠す事もできます。&lt;/p>
&lt;p>　アカウントの共有機能を使って大きなプロジェクトのDNSを複数人で管理したり、APIを使って動作を自動化したりも可能です（応用してDDNSのような使い方もできます）&lt;/p>
&lt;p>　対応しているドメインであればDNSSECなどのセキュリティ機能もありますし、格安の&lt;a class="link" href="https://www.cloudflare.com/ja-jp/products/registrar/" target="_blank" rel="noopener"
>Cloudflare Registrar&lt;/a>が利用可能な場合は、何も考えずにここに載せてもいいと思っています。&lt;/p>
&lt;h3 id="hurricane-electric-free-dns-managementhttpsdnshenet">&lt;a class="link" href="https://dns.he.net/" target="_blank" rel="noopener"
>Hurricane Electric Free DNS Management&lt;/a>&lt;/h3>
&lt;p>　Hurricane Electricが提供しているDNSです。DDNSに対応しているサービスで、かなりわかりやすい部類だと思います。DNS機能としては細かい制限がありますがクリティカルなものは無かったと思います。&lt;/p>
&lt;h2 id="email-forward">Email Forward&lt;/h2>
&lt;h3 id="improvmxhttpsimprovmxcom">&lt;a class="link" href="https://improvmx.com/" target="_blank" rel="noopener"
>ImprovMX&lt;/a>&lt;/h3>
&lt;p>　特定のドメインに来たメールすべてを特定のアドレスに転送できる凄い奴です。制限として、独自に転送先を変更できるアドレスは25個までであることと、10Mbまでの添付ファイルまでしか受け付けてくれないことがあります。&lt;/p>
&lt;h2 id="email-delivery">Email Delivery&lt;/h2>
&lt;h3 id="mailjethttpswwwmailjetcom">&lt;a class="link" href="https://www.mailjet.com/" target="_blank" rel="noopener"
>Mailjet&lt;/a>&lt;/h3>
&lt;p>　メールの送信サービスです。独自ドメインなどからメールを送信したい場合にとても重宝します（私はZabbixのアラートに使っています）。1日に200通までしか送れませんが、そこまで使うことはないと思います。（というか、1日にアラート200件来たら諦めてサーバの電源引っこ抜く）&lt;/p>
&lt;p>　APIを使ってメール送信もできるので、様々なサービスと連携ができそうです。&lt;/p>
&lt;h2 id="vpn">VPN&lt;/h2>
&lt;h3 id="tailscalehttpstailscalecom">&lt;a class="link" href="https://tailscale.com/" target="_blank" rel="noopener"
>Tailscale&lt;/a>&lt;/h3>
&lt;p>　外向きの通信が通れば大体使えるすごいやつです。無料版だと20デバイスまで接続できるとのこと。（私が初めて見たときには100だった気がする）サブネットルーティングなどが使えるためかなり便利なサービスです。（しかし、現在無料で使えるサービスにかなりの制限がかかっているので、Oracle CloudにSoftEther VPN置いたほうが良さそうと思ったり…）&lt;/p>
&lt;h3 id="vpn-azurehttpwwwvpnazurenetja">&lt;a class="link" href="http://www.vpnazure.net/ja/" target="_blank" rel="noopener"
>VPN Azure&lt;/a>&lt;/h3>
&lt;p>　SoftEther VPNに置いて、NAPTやファイアウォール超えをするときにとても重宝するサービスです。前提としてSoftEther VPN Serverを建てる必要がありますが、Oracle Cloudの無料枠などに置くと完全無料でいい感じのVPNが作れます。注意点として、内部に用意する仮想ネットワークはv6非対応です。L2 VPNではv6をつかうことが出来ます。&lt;/p></description></item><item><title>（今更）ブログをはじめました</title><link>https://blog.mkarakiapps.com/p/first-post/</link><pubDate>Sat, 22 May 2021 13:57:09 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/first-post/</guid><description>&lt;p>文字通りブログ環境を構築しました。 過去にQiitaに上げた記事のうちいくつかのコピーして上げています。&lt;/p></description></item><item><title>Oracle Cloudのminimal UbuntuのInstanceで外からつながらない問題</title><link>https://blog.mkarakiapps.com/p/20210206-oraclecloud-ubuntu-inbound-firewall/</link><pubDate>Fri, 05 Feb 2021 15:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20210206-oraclecloud-ubuntu-inbound-firewall/</guid><description>&lt;p>自分用のメモです。&lt;/p>
&lt;h1 id="環境">環境&lt;/h1>
&lt;ul>
&lt;li>Oracle Cloudインスタンス&lt;/li>
&lt;li>Image: Canonical-Ubuntu-20.04-Minimal-2020.12.10-0&lt;/li>
&lt;li>Shape: VM.Standard.E2.1.Micro&lt;/li>
&lt;/ul>
&lt;h1 id="原因">原因&lt;/h1>
&lt;p>iptablesのルールである&lt;/p>
&lt;pre>&lt;code>-A INPUT -j REJECT --reject-with icmp-host-prohibited
&lt;/code>&lt;/pre>&lt;h1 id="解決策">解決策&lt;/h1>
&lt;pre>&lt;code>/etc/iptables/rules.v4
&lt;/code>&lt;/pre>&lt;p>の17行目にある&lt;/p>
&lt;pre>&lt;code>-A INPUT -j REJECT --reject-with icmp-host-prohibited
&lt;/code>&lt;/pre>&lt;p>をコメントアウトして再起動。（すべてのポートが晒されるので注意）&lt;/p></description></item><item><title>Windows 10をUSBメモリなどに手動でインストールする方法</title><link>https://blog.mkarakiapps.com/p/20201227-win10-on-usb/</link><pubDate>Sun, 27 Dec 2020 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20201227-win10-on-usb/</guid><description>&lt;h1 id="まえがき">まえがき&lt;/h1>
&lt;p>かなり前の話になりますが、株式会社アーク情報システムということろが「BOOT革命/USB」という製品を作っていました。
この製品は、WindowsをUSBに入れる事ができることを売りにしていたソフトで、私は全く使いませんでしたが一応持ってはいました。
今回、SSDの代わりに低容量のUSBメモリを臨時で使いたいという問い合わせがあり、私なりに方法を探ったのでメモとして残します。&lt;/p>
&lt;h1 id="注意">注意&lt;/h1>
&lt;p>この記事で紹介する動作について、一切の責任を負いませんので予めご了承ください。
もし、この記事を参考にし作業する際は、自己責任でお願いします。&lt;/p>
&lt;h1 id="検証環境">検証環境&lt;/h1>
&lt;ul>
&lt;li>Windows 10 Home x64 (ビルド不明)&lt;/li>
&lt;li>VMWare Workstation 16 Player&lt;/li>
&lt;/ul>
&lt;h1 id="手順">手順&lt;/h1>
&lt;h2 id="パーティションの設定">パーティションの設定&lt;/h2>
&lt;p>Windows 10の場合、基本的にパーティションは3つ生成されます。
しかし、1つは回復領域であるため無視し、EFI用とシステム用の2つのみで構成しようと思います。&lt;/p>
&lt;p>パーティションは以下のようになります。&lt;/p>
&lt;ol>
&lt;li>200MB-500MB程度 FAT32 Active&lt;/li>
&lt;li>残りの容量 NTFS&lt;/li>
&lt;/ol>
&lt;p>設定方法は解説しませんがActiveにする方法として、&lt;code>diskpart&lt;/code>でパーティションを選択し&lt;code>active&lt;/code>コマンドを打つ方法があります。&lt;/p>
&lt;p>設定する上で2つのパーティションにドライブレターが割り当てられている必要があります。ここから先の手順では、上からそれぞれ&lt;code>E:&lt;/code>と&lt;code>F:&lt;/code>が割り当てられているとします。&lt;/p>
&lt;h2 id="イメージの展開">イメージの展開&lt;/h2>
&lt;p>一般のキッティングにも使われているであろう&lt;code>Dism&lt;/code>を使います。事前にWindows 10のインストールメディア内の&lt;code>sources/install.esd&lt;/code>を抽出してください。
此処から先の工程では、作業ディレクトリ内に抽出した&lt;code>install.esd&lt;/code>が存在し、アクセス権がある状態を想定し記載します。&lt;/p>
&lt;h3 id="イメージidを調べる">イメージIDを調べる&lt;/h3>
&lt;p>管理者権限のPowerShellもしくはコマンドプロンプトで次のコマンドを入力します。&lt;/p>
&lt;pre>&lt;code class="language-plaintext:PowerShell（管理者）" data-lang="plaintext:PowerShell（管理者）">&amp;gt; Dism /Get-WimInfo /WimFile:install.esd
&lt;/code>&lt;/pre>&lt;p>希望するエディションのインデックスを覚えておいてください。
此処から先では、&lt;code>Windows 10 Home（インデックス: 1）&lt;/code>をインストールする前提で記載していきます。&lt;/p>
&lt;h3 id="イメージを展開する">イメージを展開する&lt;/h3>
&lt;p>イメージを展開します。&lt;code>/Index:&lt;/code>と&lt;code>/ApplyDir:&lt;/code>は各自の環境に応じて変更してください。&lt;/p>
&lt;pre>&lt;code class="language-plaintext:PowerShell（管理者）" data-lang="plaintext:PowerShell（管理者）">&amp;gt; Dism /Apply-Image /ImageFile:install.esd /Index:1 /ApplyDir:F:\
&lt;/code>&lt;/pre>&lt;h3 id="ブートローダーの設定">ブートローダーの設定&lt;/h3>
&lt;p>&lt;code>bcdboot&lt;/code>を使用し、ブートローダーを設定します。各自で&lt;code>E:\Windows&lt;/code>、&lt;code>/l ja-JP&lt;/code>、&lt;code>/s E:&lt;/code>については読み替えてください。
また、&lt;code>/l ja-JP&lt;/code>はなくても動くはずです。&lt;/p>
&lt;pre>&lt;code class="language-plaintext:PowerShell（管理者）" data-lang="plaintext:PowerShell（管理者）">&amp;gt; bcdboot F:\Windows /l ja-JP /s E: /f ALL
&lt;/code>&lt;/pre>&lt;h3 id="設定oobe">設定（OOBE）&lt;/h3>
&lt;p>あとはUSBメモリからブートし、普通に設定をしていくだけです。&lt;/p>
&lt;h1 id="参考">参考&lt;/h1>
&lt;ul>
&lt;li>&lt;a class="link" href="http://ohaohaoha.cocolog-nifty.com/blog/2015/08/windows-to-go-f.html" target="_blank" rel="noopener"
>Windows To Goを作る: おはのおはなし&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di" target="_blank" rel="noopener"
>BCDBoot のコマンド ライン オプション | Microsoft Docs&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>docomo らくらくホン F-02J 物理ボタンのキーコード一覧</title><link>https://blog.mkarakiapps.com/p/docomo-f02j-button-keycodes/</link><pubDate>Fri, 13 Nov 2020 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/docomo-f02j-button-keycodes/</guid><description>&lt;p>メモ用です&lt;/p>
&lt;h2 id="環境">環境&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">データ&lt;/th>
&lt;th style="text-align:left">値&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">メーカー&lt;/td>
&lt;td style="text-align:left">Fujitsu (docomo)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">機種&lt;/td>
&lt;td style="text-align:left">F-02J&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Androidバージョン&lt;/td>
&lt;td style="text-align:left">5.1.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ビルド番号&lt;/td>
&lt;td style="text-align:left">V28R066A&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="調べ方">調べ方&lt;/h2>
&lt;p>Android API の&lt;code>onKeyDown&lt;/code>メソッド引数&lt;code>keyCode&lt;/code>を参照&lt;/p>
&lt;h1 id="実測値">実測値&lt;/h1>
&lt;h2 id="ダイヤルパッド">ダイヤルパッド&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">1&lt;/td>
&lt;td style="text-align:left">8&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">2&lt;/td>
&lt;td style="text-align:left">9&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">3&lt;/td>
&lt;td style="text-align:left">10&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">4&lt;/td>
&lt;td style="text-align:left">11&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">5&lt;/td>
&lt;td style="text-align:left">12&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">6&lt;/td>
&lt;td style="text-align:left">13&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">7&lt;/td>
&lt;td style="text-align:left">14&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">8&lt;/td>
&lt;td style="text-align:left">15&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">9&lt;/td>
&lt;td style="text-align:left">16&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">*&lt;/td>
&lt;td style="text-align:left">17&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">0&lt;/td>
&lt;td style="text-align:left">7&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">#&lt;/td>
&lt;td style="text-align:left">18&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="ワンタッチダイアル">ワンタッチダイアル&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">１&lt;/td>
&lt;td style="text-align:left">96&lt;/td>
&lt;td style="text-align:left">外部アプリケーションのポインタ切り替えにも利用（無効化不可）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">２&lt;/td>
&lt;td style="text-align:left">97&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">３&lt;/td>
&lt;td style="text-align:left">98&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="方向サブメニューキー">方向・サブメニューキー&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">↑&lt;/td>
&lt;td style="text-align:left">19&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">↓&lt;/td>
&lt;td style="text-align:left">20&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">←&lt;/td>
&lt;td style="text-align:left">21&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">→&lt;/td>
&lt;td style="text-align:left">22&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">決定&lt;/td>
&lt;td style="text-align:left">23&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">メニュー&lt;/td>
&lt;td style="text-align:left">131&lt;/td>
&lt;td style="text-align:left">Androidの機能に割り当てられている可能性あり（詳細不明）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">電話帳&lt;/td>
&lt;td style="text-align:left">132&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="発信戻る">発信・戻る&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">発信&lt;/td>
&lt;td style="text-align:left">5&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">戻る&lt;/td>
&lt;td style="text-align:left">4&lt;/td>
&lt;td style="text-align:left">AndroidのBackボタンに割り当て&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">切断&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">不明（アプリケーションの終了になっているため）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="本体下部ファンクションボタン">本体下部ファンクションボタン&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">使い方&lt;/td>
&lt;td style="text-align:left">104&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">らくらくサイト&lt;/td>
&lt;td style="text-align:left">105&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">カメラ&lt;/td>
&lt;td style="text-align:left">103&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="サイドボタン">サイドボタン&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">読み上げ&lt;/td>
&lt;td style="text-align:left">102&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">+&lt;/td>
&lt;td style="text-align:left">24&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">25&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="ワンタッチブザー">ワンタッチブザー&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">表示キー&lt;/th>
&lt;th style="text-align:left">キーコード&lt;/th>
&lt;th style="text-align:left">備考&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">ワンタッチブザー&lt;/td>
&lt;td style="text-align:left">83&lt;/td>
&lt;td style="text-align:left">（引き抜き時のみ。引き抜き状態では画面が隠される）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Raspberry Pi上でUbuntu server 20.04を動かしてsshできるようにするまで</title><link>https://blog.mkarakiapps.com/p/20201010-ubuntuserver-on-rpi/</link><pubDate>Sat, 10 Oct 2020 00:00:00 +0900</pubDate><guid>https://blog.mkarakiapps.com/p/20201010-ubuntuserver-on-rpi/</guid><description>&lt;h1 id="経緯">経緯&lt;/h1>
&lt;p>Raspbian環境が壊れたので新しく環境を用意しようとしたところ、私の大好きなUbuntuが使えることを知りました。しかし、インストールからsshできるまでかなりの時間を割かなければならなかったので、ここにメモがてら書き留めることにしました。&lt;/p>
&lt;h1 id="イメージ焼き">イメージ焼き&lt;/h1>
&lt;p>特に難しいことはないです。&lt;a class="link" href="https://ubuntu.com/download/raspberry-pi" target="_blank" rel="noopener"
>Install Ubuntu Server on a Raspberry Pi 2, 3 or 4 | Ubuntu&lt;/a> から使いたいRaspberry Pi向けのイメージをダウンロードしてください。
その際、zipではなくxzで圧縮されていますので、Windowsユーザーの方は7zipなどを使ってください。&lt;/p>
&lt;h1 id="起動">起動&lt;/h1>
&lt;p>初期パスワードだけ注意してください。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ユーザー名&lt;/th>
&lt;th>パスワード&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ubuntu&lt;/td>
&lt;td>ubuntu&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>その際、パスワードの変更を求められます。もう一度初期パスワードの入力をしなければならないのでご注意ください。&lt;/p>
&lt;h1 id="openssh-serverの設定">openssh-serverの設定&lt;/h1>
&lt;p>openssh-serverはインストールされていますが、hostkeyが設定されていません。
次のコマンドを使ってhostkeyを自動生成させてください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo dpkg-reconfigure openssh-server
&lt;/code>&lt;/pre>&lt;/div>&lt;p>生成出来たらopenssh-serverを再起動してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">$ sudo service ssh restart
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="参考">参考&lt;/h1>
&lt;ul>
&lt;li>Ubuntu 20.04 LTS Server を Raspberry Pi 4 にインストール - Qiita, &lt;a class="link" href="https://qiita.com/azumabashi/items/182f365cf7405156788c" target="_blank" rel="noopener"
>https://qiita.com/azumabashi/items/182f365cf7405156788c&lt;/a> 2020.10.10 参照.&lt;/li>
&lt;li>How To: Ubuntu / Debian Linux Regenerate OpenSSH Host Keys - nixCraft, &lt;a class="link" href="https://www.cyberciti.biz/faq/howto-regenerate-openssh-host-keys/" target="_blank" rel="noopener"
>https://www.cyberciti.biz/faq/howto-regenerate-openssh-host-keys/&lt;/a> 2020.10.10 参照.&lt;/li>
&lt;/ul></description></item><item><title>PowerShellを使ってMinecraftのリソースを正式名でエクスポートする</title><link>https://blog.mkarakiapps.com/p/20200807-minecraft-export-resname-with-powershell/</link><pubDate>Thu, 06 Aug 2020 15:00:00 +0000</pubDate><guid>https://blog.mkarakiapps.com/p/20200807-minecraft-export-resname-with-powershell/</guid><description>&lt;h1 id="最初に">最初に&lt;/h1>
&lt;p>Minecraftはデフォルトリソースをハッシュ名にして保存しています。実際のリソース名とはJSONファイルを使用して関連付けています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;objects&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="nt">&amp;#34;resource1.png&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;hash&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1234&lt;/span>&lt;span class="p">},&lt;/span>
&lt;span class="nt">&amp;#34;resource2.png&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;hash&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5678&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>このような形でハッシュとリソース名を対応付けています。これをリソース名にしてエクスポートしようという試みです。&lt;/p>
&lt;h1 id="対応環境">対応環境&lt;/h1>
&lt;p>Minecraft 1.16とPowerShell 5.1で実行できることを確認しました。また、オープンソース版のPowerShellでも実行できると思われます。&lt;/p>
&lt;p>&lt;strong>最低限の検証しかしていません。&lt;/strong>&lt;/p>
&lt;h1 id="実際のコード">実際のコード&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="nv">$objects_dir&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;C:\Users\Owner\AppData\Roaming\.minecraft\assets\objects&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c"># .minecraftフォルダ内のassets/objectsまでのフルパス&lt;/span>
&lt;span class="nv">$listjson&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;C:\Users\Owner\AppData\Roaming\.minecraft\assets\indexes\1.16.json&amp;#34;&lt;/span> &lt;span class="c"># .minecraftフォルダ内のassets/indexes内の任意のバージョン名のJSONファイルまでのフルパス&lt;/span>
&lt;span class="nv">$exportdir&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;C:\Users\Owner\AppData\Roaming\.minecraft\assets\extracted&amp;#34;&lt;/span> &lt;span class="c"># エクスポート先フォルダのフルパス&lt;/span>
&lt;span class="c"># ===================&lt;/span>
&lt;span class="nv">$json&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">Get-Content&lt;/span> &lt;span class="nv">$listjson&lt;/span>
&lt;span class="nv">$list&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">ConvertFrom-Json&lt;/span> &lt;span class="n">-InputObject&lt;/span> &lt;span class="nv">$json&lt;/span>
&lt;span class="k">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$r&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">$list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">objects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">psobject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Properties&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nv">$fname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Name&lt;/span>
&lt;span class="nv">$afname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$list&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">objects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nv">$fname&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">hash&lt;/span>
&lt;span class="nv">$hash_dirname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$afname&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nv">$from&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$objects_dir&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;\&amp;#39;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="nv">$hash_dirname&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;\&amp;#39;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="nv">$afname&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nv">$to&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nv">$exportdir&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="s1">&amp;#39;\&amp;#39;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="nv">$fname&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="nv">$destdir&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">Split-Path&lt;/span> &lt;span class="nv">$to&lt;/span> &lt;span class="n">-Parent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(!(&lt;/span>&lt;span class="nb">Test-Path&lt;/span> &lt;span class="n">-Path&lt;/span> &lt;span class="nv">$destdir&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nv">$0_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">New-Item&lt;/span> &lt;span class="nv">$destdir&lt;/span> &lt;span class="n">-Type&lt;/span> &lt;span class="n">Directory&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nb">Copy-Item&lt;/span> &lt;span class="n">-Path&lt;/span> &lt;span class="nv">$from&lt;/span> &lt;span class="n">-Destination&lt;/span> &lt;span class="nv">$to&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>汚いコードですが概ねこのような形です。先頭の３行(改行含め４行)を書き換えて利用してください。&lt;/p>
&lt;h1 id="注意点解説">注意点・解説&lt;/h1>
&lt;p>　先ほども説明した通り、JSONでリストが作られています。そのため、&lt;code>ConvertFrom-Json&lt;/code>で簡単に読み込むことができました。しかし、いくつか注意点があります。&lt;/p>
&lt;h2 id="powershell-51ではjsonをhashtableにできない">PowerShell 5.1ではJSONをHashtableにできない&lt;/h2>
&lt;p>　Windows 10に標準搭載されているPowerShellは&lt;code>-AsHashtable&lt;/code>オプションに対応していません。そのため、&lt;code>PSCustomObject&lt;/code>で出力されたオブジェクト名をそのまま取得することができません。
　これを解決するために、foreach文では&lt;code>psobject.Properties&lt;/code>を取得したいオブジェクトにつけることによって、プロパティのデータをforeachにかけています。
　これによって取得したオブジェクト名をそのまま埋め込み、&lt;code>$list.objects.$fname.hash&lt;/code>とすることによってPSCustomObjectのままでデータを取得しています。&lt;/p>
&lt;h2 id="ファイルコピー時に親ディレクトリがない">ファイルコピー時に親ディレクトリがない&lt;/h2>
&lt;p>　PowerShellの&lt;code>Copy-Item&lt;/code>コマンドレットは親ディレクトリを自動的に作ることはできません。そのため、&lt;code>Split-Path $to -Parent&lt;/code>で親ディレクトリを取得し、当該ディレクトリがなかった場合は、新しくディレクトリを作成しています。&lt;/p>
&lt;h2 id="ディレクトリ作成時のログ">ディレクトリ作成時のログ&lt;/h2>
&lt;p>&lt;code>New-Item&lt;/code>コマンドレットを使用すると、実行時に結果としてディレクトリの詳細データを出力します。しかし、今回は邪魔なだけなので、&lt;code>$0_&lt;/code>変数に結果を代入させることによって表示をなくしています。&lt;/p></description></item></channel></rss>