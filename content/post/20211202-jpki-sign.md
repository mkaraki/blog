---
title: 日本国の公的個人認証サービスを利用したPDF署名とその受け入れ
tags: 
- JPKI
- マイナンバー
- PDF
- 署名
date: 2021-12-02T00:00:00+09:00
slug: '20211202-jpki-sign'
tableOfContents: true
---

[JPKI]: https://www.jpki.go.jp
[Adobe Acrobat Reader]: https://www.adobe.com/acrobat/pdf-reader.html
[Adobe Inc.]: https://www.adobe.com/
[JPKI PDF SIGNER]: https://jpki.osdn.jp/

## 初めに
[公的個人認証サービス(JPKI)][JPKI]は国および地方公共団体が共同で運営する[地方公共団体情報システム機構](https://www.j-lis.go.jp/)の提供するサービスである。

この記事では2021/12/02時点でのこのサービスとマイナンバーカードを利用したPDF署名とその受け入れについて記述するため、今後この記事の内容が利用できなくなる可能性も存在する。

マイナンバーに関する法律は多くあり、それらを遵守したうえで本ページを参考にしていただきたい。この記事が必ずにも現在の法律に**適応しているわけではない**ことを留意したうえで閲覧していただきたい。

## 署名により記録される情報
署名をすることにより、下記の個人情報がPDFファイルに記載される。
- 氏名
- マイナンバー上に記述されている都道府県及び市町村

上記情報を渡したくない相手に対しては署名したファイルを送信しないことを強く推奨する。

## サードパーティ製のソフトウェアを利用して署名する
公式的に署名する方法は[PDF署名プラグイン](https://www.touki-kyoutaku-online.moj.go.jp/cautions/security/pdf_sign_inst.html)を利用する方法が[法務省](https://www.moj.go.jp/)([登記ねっと 供託ねっと](https://www.touki-kyoutaku-online.moj.go.jp/))から提供されている。
しかし、この方法では[Adobe Inc.]の[Adobe Acrobat](https://www.adobe.com/acrobat.html)が必要であり、個人では敷居が高い。(無料版の[Adobe Acrobat Reader]では署名の検証のみ可能)

今回は有志の方が開発した[JPKI PDF SIGNER]\(無料)を利用する。

### 事前準備
あらかじめカードリーダのドライバをインストールしておく必要がある。

### 利用者クライアントソフトのインストール
[JPKI][JPKI]の提供する[利用者クライアントソフト](https://www.jpki.go.jp/download/index.html)をダウンロードし、インストールする必要がある。

> **注意:**
> WindowsのロケールはJapaneseである必要性がある。この設定がされていない場合インストーラや本体ソフトウェアが動作しない。

### JPKI PDF SIGNERのダウンロード
先に説明した通り、[JPKI PDF SIGNER]は有志の開発したマイナンバー用のPDF署名ソフトウェアである。

もし第三者の作成したソフトウェアに不信感を感じる場合、[OSDNページ](https://ja.osdn.net/projects/jpki/)からソースコードをダウンロードし、ユーザ側で検証とビルドを行うことを推奨する。

このアプリケーションにインストーラは存在しない。[公式ページ][JPKI PDF SIGNER]からzipファイルをダウンロードし、各自で解凍して利用する。

### 署名を行う
[公式サイト][JPKI PDF SIGNER]に操作方法が記述されているので説明は不要であると思うが念のために記述する。

#### 印影を利用しない署名
JPKI PDF SIGNERでPDFファイルを開き、右側メニューの`印影なしで電子署名する`をクリックする。
マイナンバーカードがコンピュータに認識されていれば`公的個人認証　署名用パスワード`の入力が求められる。

> **注意:**
> [JPKI]のサイトでは、「署名用電子証明書のパスワードを5回間違えるとロックされ、市区町村窓口でのロック解除が必要となる。」とアナウンスされている。
>
> 詳細は[パスワードの失念](https://www.jpki.go.jp/procedure/password.html)を参照のこと。

## 署名された文章の受け入れ
署名の検証には[Adobe Inc.]の[Adobe Acrobat Reader]\(無料)を利用する。

### Adobe Acrobat Readerのインストール
[公式インストールマニュアル](https://helpx.adobe.com/jp/acrobat/kb/cq101423182.html)を参考に[Adobe Acrobat Reader]をインストールする。

### ルート証明書のダウンロード
[JPKI]サイトからルート証明書をダウンロードする。

1. [認証局の運営](https://www.jpki.go.jp/ca/index.html)ページにアクセスする。
2. 画面左メニューから[署名用認証局の運営に関する情報](https://www.jpki.go.jp/ca/ca_rules3.html)を開く
3. `署名用認証局の自己署名証明書`を選択しダウンロードする。

> **注意:**
> 署名用認証局の自己署名証明書は存在するすべての証明書をダウンロードし追加すること。
> これは、マイナンバー(証明書)発行時期により利用されているルート証明書が異なるためである。

### ルート証明書の追加
悲しいことにAdobe Acrobat ReaderにはJPKIで利用されている署名用認証局の自己署名証明書は信頼リストに追加されていない。
そのため、手動で信頼リストに追加する必要がある。

下記に手順を示す
1. Acrobat Readerを開きウィンドウ上部のメニューバーから`編集`->`環境設定`と進む
2. 設定画面左側のメニューから`署名`を選択
3. `IDと信頼済み証明書`メニューを開く
4. ウィンドウ左メニューから`信頼済み証明書`を選択
5. 画面上部の![取り込み](https://user-images.githubusercontent.com/26180919/144451492-feb927af-564f-4a08-a84c-84f49b491647.png)を選択
6. 新規ウィンドウ上側リスト右の参照を選択
7. ダウンロードしたルート証明書を選択
8. 複数のルート証明書をダウンロードした場合は手順`6.`から別の証明書を読み込む
9. ウィンドウ下の取り込みボタンを選択
10. Acrobat Readerを再起動する
11. 再度手順`4.`まで進める
12. `公的個人認証サービス署名用, 地方公共団体情報システム機構`から始まる証明書を1つずつ選択し、![信頼性を編集](https://user-images.githubusercontent.com/26180919/144453978-7a28b974-b635-4af8-9c6d-ed52da298023.png)ボタンを選択する
13. `この証明書を信頼済みのルートとして使用`にチェックを入れ、画面下`OK`をクリックする
14. 2つ以上追加した場合は手順`12.`に戻りすべての証明書に実施する
15. 再度Acrobat Readerを再起動する


以上でルート証明書が信頼リストに追加される。

### 署名を検証する
Acrobat Readerで検証したいファイルを開く。

![署名済みであり、すべての署名が有効です。](https://user-images.githubusercontent.com/26180919/144454484-dcf3f6dc-fcef-4c5a-8265-ad1bb7e49c04.png)  
の表示が出れば問題ない。

#### 署名者を確認する
[署名を検証する](#署名を検証する)セクションで出たアラートにある`署名パネル`ボタンを選択する

- 署名者を確認したい署名を開き、`署名の詳細`を開くと署名者の氏名が表示される。
- 上状態で`証明書の詳細…`をクリックすると証明書の情報を確認でき、ここで市町村のデータなどが閲覧できる。
